<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>„Ç´„Éº„ÉâÁ∑®ÈõÜ„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥ „É¢„ÉÉ„ÇØ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      color-scheme: light dark;
      font-family: "Segoe UI", "Hiragino Sans", "Yu Gothic", sans-serif;
      --bg: #ffffff;
      --sub-bg: #f9fafb;
      --border: #d1d5db;
      --text: #111827;
      --accent: #3b82f6;
      --accent-soft: rgba(59, 130, 246, 0.1);
      --sidebar-width: 256px;
    }

    body.dark {
      --bg: #111827;
      --sub-bg: #1f2937;
      --border: #374151;
      --text: #f9fafb;
      --accent: #60a5fa;
      --accent-soft: rgba(96, 165, 250, 0.15);
      background: var(--bg);
      color: var(--text);
    }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .menu-bar,
    .status-bar {
      background: var(--sub-bg);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      padding: 0 16px;
      font-size: 14px;
      height: 32px;
      gap: 24px;
    }

    .status-bar {
      border-top: 1px solid var(--border);
      border-bottom: none;
      justify-content: space-between;
      font-size: 11px;
      height: 24px;
    }

    .menu-item {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .menu-item span:first-child {
      font-weight: 600;
      text-decoration: underline;
    }

    .toolbar {
      display: flex;
      align-items: center;
      padding: 0 16px;
      gap: 16px;
      height: 40px;
      border-bottom: 1px solid var(--border);
      background: var(--sub-bg);
    }

    .toolbar-group {
      display: flex;
      gap: 8px;
      align-items: center;
      position: relative;
    }

    .toolbar-group + .toolbar-group::before {
      content: "";
      position: absolute;
      left: -8px;
      top: 8px;
      bottom: 8px;
      width: 1px;
      background: var(--border);
    }

    button.icon {
      height: 28px;
      padding: 4px 10px;
      border-radius: 6px;
      border: 1px solid var(--border);
      background: var(--bg);
      color: inherit;
      font-size: 14px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    button.icon.active {
      background: var(--accent-soft);
      color: var(--accent);
      border-color: var(--accent);
    }

    button.icon:hover,
    .tab:hover,
    .sidebar-item:hover,
    .log-header button:hover {
      background: var(--accent-soft);
    }

    .main {
      flex: 1;
      display: grid;
      grid-template-columns: var(--sidebar-width) 1fr;
      overflow: hidden;
    }

    .sidebar {
      display: flex;
      flex-direction: column;
      border-right: 1px solid var(--border);
      background: var(--sub-bg);
    }

    .sidebar-section {
      padding: 12px 12px 0;
    }

    .sidebar-section h2 {
      font-size: 12px;
      font-weight: 600;
      margin: 0 0 8px;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    .sidebar-list {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-bottom: 16px;
    }

    .sidebar-item {
      display: flex;
      gap: 8px;
      align-items: center;
      padding: 6px 8px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
    }

    .sidebar-item.active {
      background: var(--accent-soft);
      color: var(--accent);
      font-weight: 600;
    }

    .search-box {
      position: relative;
      margin: 0 12px 16px;
    }

    .search-box input {
      width: 100%;
      padding: 8px 12px 8px 32px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: var(--bg);
      color: inherit;
      font-size: 13px;
    }

    .search-box span {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      opacity: 0.6;
    }

    .content-area {
      display: grid;
      grid-template-rows: 1fr 160px;
      height: 100%;
    }

    .panels {
      display: grid;
      grid-template-columns: 1fr 1fr;
      background: var(--bg);
      position: relative;
    }

    .panel {
      display: flex;
      flex-direction: column;
      border-right: 1px solid var(--border);
    }

    .panel:last-child {
      border-right: none;
    }

    .tab-bar {
      display: flex;
      gap: 1px;
      background: var(--sub-bg);
      border-bottom: 1px solid var(--border);
      height: 36px;
      align-items: flex-end;
      padding: 0 8px;
    }

    .tab {
      display: flex;
      align-items: center;
      gap: 6px;
      background: var(--border);
      color: inherit;
      border-radius: 6px 6px 0 0;
      padding: 6px 12px;
      font-size: 13px;
      cursor: pointer;
      position: relative;
    }

    .tab.active {
      background: var(--bg);
      border: 1px solid var(--border);
      border-bottom: none;
      font-weight: 600;
    }

    .tab .status-dot {
      font-size: 10px;
      color: #f97316;
    }

    .card-toolbar {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 8px 16px;
      border-bottom: 1px solid var(--border);
      background: var(--sub-bg);
      font-size: 12px;
    }

    .card-toolbar-group {
      display: flex;
      gap: 8px;
      align-items: center;
      position: relative;
    }

    .card-toolbar-group + .card-toolbar-group::before {
      content: "";
      position: absolute;
      left: -6px;
      top: 0;
      bottom: 0;
      width: 1px;
      background: var(--border);
    }

    .card-list {
      flex: 1;
      overflow: auto;
      padding: 16px;
      background: var(--bg);
      position: relative;
    }

    .card-item {
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
      position: relative;
      transition: background 0.2s ease, border 0.2s ease;
    }

    .card-item.compact {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: 8px;
    }

    .card-item[data-selected="true"] {
      background: rgba(59, 130, 246, 0.1);
      border-left: 4px solid var(--accent);
    }

    .card-item:hover {
      background: rgba(59, 130, 246, 0.06);
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
      gap: 12px;
    }

    .card-main {
      display: flex;
      align-items: flex-start;
      gap: 12px;
    }

    .trace-dot {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      border: 2px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      color: var(--accent);
    }

    .trace-dot.active {
      background: var(--accent);
      color: #fff;
    }

    .card-body textarea,
    .card-body .card-text {
      width: 100%;
      border: none;
      background: transparent;
      color: inherit;
      font-size: 14px;
      line-height: 1.5;
      resize: none;
    }

    .card-body textarea:focus {
      outline: none;
    }

    .badge {
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 10px;
      text-transform: uppercase;
      font-weight: 600;
      letter-spacing: 0.05em;
    }

    .badge[data-status="approved"] {
      background: #d1fae5;
      color: #065f46;
    }

    .badge[data-status="review"] {
      background: #fef3c7;
      color: #92400e;
    }

    .badge[data-status="draft"] {
      background: #f3f4f6;
      color: #4b5563;
    }

    .badge[data-status="deprecated"] {
      background: #fee2e2;
      color: #991b1b;
    }

    .card-footer {
      font-size: 12px;
      color: rgba(107, 114, 128, 0.9);
      margin-top: 8px;
    }

    .indent-level-1 { margin-left: 24px; }
    .indent-level-2 { margin-left: 48px; }
    .indent-level-3 { margin-left: 72px; }

    .log-panel {
      border-top: 1px solid var(--border);
      background: var(--sub-bg);
      display: flex;
      flex-direction: column;
    }

    .log-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 16px;
      background: var(--sub-bg);
      border-bottom: 1px solid var(--border);
    }

    .log-body {
      flex: 1;
      padding: 16px;
      font-family: "Fira Code", "Consolas", monospace;
      font-size: 12px;
      overflow: auto;
      background: var(--bg);
    }

    .log-line {
      margin-bottom: 6px;
    }

    .log-line[data-level="INFO"] { color: #16a34a; }
    .log-line[data-level="WARN"] { color: #d97706; }
    .log-line[data-level="ERROR"] { color: #dc2626; }
    .log-line[data-level="DEBUG"] { color: #2563eb; }

    .trace-overlay {
      position: absolute;
      inset: 0;
      pointer-events: none;
    }

    .trace-overlay svg {
      width: 100%;
      height: 100%;
    }

    .trace-line {
      stroke: var(--accent);
      stroke-width: 2;
      fill: none;
      opacity: 0.6;
      marker-end: url(#arrowhead);
    }

    .theme-toggle {
      margin-left: auto;
    }

    .filter-input {
      padding: 6px 8px;
      border-radius: 6px;
      border: 1px solid var(--border);
      background: var(--bg);
      color: inherit;
      width: 160px;
    }

    .card-item.hidden { display: none; }
  </style>
</head>
<body>
  <div class="menu-bar">
    <div class="menu-item"><span>F</span><span>„Éï„Ç°„Ç§„É´</span></div>
    <div class="menu-item"><span>E</span><span>Á∑®ÈõÜ</span></div>
    <div class="menu-item"><span>V</span><span>Ë°®Á§∫</span></div>
    <div class="menu-item"><span>H</span><span>„Éò„É´„Éó</span></div>
  </div>
  <div class="toolbar">
    <div class="toolbar-group">
      <button class="icon" title="„Éï„Ç°„Ç§„É´„ÇíÈñã„Åè"><span>üìÇ</span><span>Èñã„Åè</span></button>
      <button class="icon" title="‰øùÂ≠ò"><span>üíæ</span><span>‰øùÂ≠ò</span></button>
    </div>
    <div class="toolbar-group">
      <button class="icon" id="trace-toggle" title="„Éà„É¨„Éº„ÇπË°®Á§∫ÂàáÊõø"><span>‚õìÔ∏è</span><span>„Éà„É¨„Éº„Çπ</span></button>
      <button class="icon" title="„Éà„É¨„Éº„Çπ„Çø„Ç§„Éó„Éï„Ç£„É´„Çø"><span>‚õèÔ∏è</span><span>„Çø„Ç§„Éó</span></button>
    </div>
    <div class="toolbar-group">
      <button class="icon" title="Ê∞¥Âπ≥ÂàÜÂâ≤"><span>‚¨å</span></button>
      <button class="icon" title="ÂûÇÁõ¥ÂàÜÂâ≤"><span>‚¨ç</span></button>
    </div>
    <button class="icon theme-toggle" id="themeToggle" title="„ÉÜ„Éº„ÉûÂàáÊõø">üåó „ÉÜ„Éº„Éû</button>
  </div>
  <div class="main">
    <aside class="sidebar">
      <div class="sidebar-section">
        <h2>„Ç®„ÇØ„Çπ„Éó„É≠„Éº„É©</h2>
        <div class="sidebar-list" id="fileList"></div>
      </div>
      <div class="sidebar-section">
        <h2>Ê§úÁ¥¢</h2>
      </div>
      <div class="search-box">
        <span>üîç</span>
        <input type="text" id="searchInput" placeholder="„Ç´„Éº„Éâ„ÇíÊ§úÁ¥¢" />
      </div>
    </aside>
    <div class="content-area">
      <div class="panels" id="panels">
        <div class="trace-overlay" id="traceOverlay"></div>
      </div>
      <div class="log-panel">
        <div class="log-header">
          <strong>Âãï‰Ωú„É≠„Ç∞</strong>
          <button class="icon" id="clearLog">„ÇØ„É™„Ç¢</button>
        </div>
        <div class="log-body" id="logBody"></div>
      </div>
    </div>
  </div>
  <div class="status-bar">
    <div>
      <span id="statusTotal">Á∑è„Ç´„Éº„ÉâÊï∞: 0</span>
      <span>ÔΩú</span>
      <span id="statusSelected">ÈÅ∏Êäû„Ç´„Éº„Éâ: -</span>
      <span>ÔΩú</span>
      <span id="statusSave">‚óè Êú™‰øùÂ≠ò</span>
    </div>
    <div>
      <span>UTF-8</span>
      <span>ÔΩú</span>
      <span id="statusTheme">„É©„Ç§„Éà„É¢„Éº„Éâ</span>
    </div>
  </div>
  <script>
    const mockFiles = [
      { name: "„Ç∑„Çπ„ÉÜ„É†Ë¶ÅÊ±Ç.md", unsaved: true },
      { name: "UIË®≠Ë®à.md", unsaved: false },
      { name: "Ë©¶È®ì‰ªïÊßò.md", unsaved: false }
    ];

    const mockPanels = [
      {
        id: "leftPanel",
        title: "Ë¶Å‰ª∂ÂàÜÂâ≤„Ç´„Éº„Éâ.json",
        cards: [
          {
            id: "C-001",
            level: 0,
            icon: "üìë",
            status: "approved",
            text: "1. „Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥Ê¶ÇË¶Å",
            updated: "2025-10-19 14:30",
            hasTrace: true
          },
          {
            id: "C-002",
            level: 1,
            icon: "üìù",
            status: "review",
            text: "ÈùûÊßãÈÄ†ÂåñÊñáÊõ∏„Çí„Ç´„Éº„ÉâÂçò‰Ωç„ÅßÁÆ°ÁêÜ„Åó„ÄÅ„Éà„É¨„Éº„Çµ„Éì„É™„ÉÜ„Ç£„ÇíÁ¢∫‰øù„Åô„Çã„ÄÇ",
            updated: "2025-10-19 12:10",
            hasTrace: true
          },
          {
            id: "C-003",
            level: 1,
            icon: "üìù",
            status: "draft",
            text: "„Ç´„Éº„ÉâÂ§âÊèõ„ÅØÂõ∫ÂÆö„É´„Éº„É´„Å®LLMÂ§âÊèõ„ÇíÂàá„ÇäÊõø„ÅàÂèØËÉΩ„Å´„Åô„Çã„ÄÇ",
            updated: "2025-10-18 21:02",
            hasTrace: false
          },
          {
            id: "C-004",
            level: 0,
            icon: "üìë",
            status: "approved",
            text: "2. ÂÖ±ÈÄöÊ©üËÉΩ",
            updated: "2025-10-17 08:32",
            hasTrace: true
          },
          {
            id: "C-005",
            level: 1,
            icon: "üìä",
            status: "review",
            text: "„Éï„Ç°„Ç§„É´ÂÖ•Âá∫Âäõ„ÅØTXT/MD„Å´ÂØæÂøú„Åó„ÄÅ5,000„Ç´„Éº„Éâ„Åß1ÁßíÊú™Ê∫Ä„ÇíÁõÆÊ®ô„Å®„Åô„Çã„ÄÇ",
            updated: "2025-10-16 18:11",
            hasTrace: true
          }
        ]
      },
      {
        id: "rightPanel",
        title: "UIË®≠Ë®à„Ç´„Éº„Éâ.json",
        cards: [
          {
            id: "U-101",
            level: 0,
            icon: "üìë",
            status: "review",
            text: "1. Ë®≠Ë®à„Ç≥„É≥„Çª„Éó„Éà",
            updated: "2025-10-20 09:44",
            hasTrace: true
          },
          {
            id: "U-102",
            level: 1,
            icon: "üìù",
            status: "review",
            text: "Ë¶ñË™çÊÄß„ÅÆÈ´ò„Åï„Å®Êìç‰ΩúÂäπÁéá„ÇíÈáçË¶ñ„Åó„Åü„É¨„Ç§„Ç¢„Ç¶„Éà„ÇíÊé°Áî®„Åô„Çã„ÄÇ",
            updated: "2025-10-20 09:50",
            hasTrace: true
          },
          {
            id: "U-103",
            level: 0,
            icon: "üìë",
            status: "approved",
            text: "2. „É¨„Ç§„Ç¢„Ç¶„ÉàÊßãÊàê",
            updated: "2025-10-19 16:20",
            hasTrace: true
          },
          {
            id: "U-104",
            level: 1,
            icon: "üìù",
            status: "draft",
            text: "„É°„Éã„É•„Éº„Éê„Éº32px„ÄÅ„ÉÑ„Éº„É´„Éê„Éº40px„ÄÅ„Çµ„Ç§„Éâ„Éê„Éº256px„ÇíÂü∫Ê∫ñ„Å®„Åô„Çã„ÄÇ",
            updated: "2025-10-19 16:30",
            hasTrace: true
          }
        ]
      }
    ];

    const mockLog = [
      { time: "2025-10-20 10:02:15", level: "INFO", message: "„Ç´„Éº„Éâ„Éï„Ç°„Ç§„É´„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü" },
      { time: "2025-10-20 10:02:16", level: "DEBUG", message: "LLMÂ§âÊèõ„É¢„Éº„Éâ: Âõ∫ÂÆö„É´„Éº„É´" },
      { time: "2025-10-20 10:02:20", level: "WARN", message: "„Ç´„Éº„Éâ C-003 „Å´„É¨„Éì„É•„ÉºÊú™ÂÆå‰∫Ü„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„ÅåÊÆã„Å£„Å¶„ÅÑ„Åæ„Åô" },
      { time: "2025-10-20 10:02:24", level: "INFO", message: "„Éà„É¨„Éº„Çµ„Éì„É™„ÉÜ„Ç£Ë°®Á§∫„ÇíÊúâÂäπÂåñ„Åó„Åæ„Åó„Åü" }
    ];

    const traces = [
      { fromPanel: "leftPanel", fromId: "C-002", toPanel: "rightPanel", toId: "U-102" },
      { fromPanel: "leftPanel", fromId: "C-005", toPanel: "rightPanel", toId: "U-104" }
    ];

    const fileList = document.getElementById("fileList");
    mockFiles.forEach((file, idx) => {
      const item = document.createElement("div");
      item.className = "sidebar-item" + (idx === 0 ? " active" : "");
      item.innerHTML = `<span>${file.unsaved ? "üìÑ" : "üìÅ"}</span><span>${file.name}</span>${file.unsaved ? '<span class="status-dot">‚óè</span>' : ""}`;
      fileList.appendChild(item);
    });

    const panelsContainer = document.getElementById("panels");

    function renderPanels(compact = false, filter = "") {
      panelsContainer.querySelectorAll(".panel").forEach((p) => p.remove());
      const matchedCards = [];
      mockPanels.forEach((panel) => {
        const panelEl = document.createElement("section");
        panelEl.className = "panel";
        panelEl.dataset.panelId = panel.id;
        panelEl.innerHTML = `
          <div class="tab-bar">
            <div class="tab active"><span>üìÑ</span><span>${panel.title}</span><span class="status-dot">‚óè</span></div>
            <div class="tab">‚ûï Êñ∞Ë¶è</div>
          </div>
          <div class="card-toolbar">
            <div class="card-toolbar-group">
              <button class="icon" data-action="expand">‚ñº Â±ïÈñã</button>
              <button class="icon" data-action="collapse">‚ñ∂ ÊäòÁï≥</button>
            </div>
            <div class="card-toolbar-group">
              <input class="filter-input" type="text" placeholder="ÊñáÂ≠óÂàó„Éï„Ç£„É´„Çø" value="${filter}" />
              <button class="icon" title="„Ç´„Éº„ÉâÊÉÖÂ†±Á®ÆÂà•"><span>üóÇÔ∏è</span></button>
              <button class="icon" title="„Éà„É¨„Éº„ÇπÈñ¢‰øÇ„ÅÆ„Åø"><span>üîΩ</span></button>
            </div>
            <div class="card-toolbar-group">
              <button class="icon compact-toggle ${compact ? "active" : ""}"><span>‚ò∞</span> „Ç≥„É≥„Éë„ÇØ„Éà</button>
            </div>
          </div>
          <div class="card-list"></div>
        `;

        const list = panelEl.querySelector(".card-list");
        panel.cards.forEach((card) => {
          const matchesFilter = card.text.toLowerCase().includes(filter.toLowerCase());
          if (matchesFilter) {
            matchedCards.push(card.id);
          }
          const cardEl = document.createElement("article");
          cardEl.className = `card-item indent-level-${card.level}`;
          cardEl.dataset.cardId = card.id;
          cardEl.innerHTML = compact
            ? `
              <div class="trace-dot ${card.hasTrace ? "active" : ""}"></div>
              <span>${card.icon}</span>
              <span class="badge" data-status="${card.status}">${card.status}</span>
              <div class="card-text">${card.text}</div>
            `
            : `
              <div class="card-header">
                <div class="card-main">
                  <div class="trace-dot ${card.hasTrace ? "active" : ""}"></div>
                  <button class="icon" style="padding:2px 6px" title="Â±ïÈñã/ÊäòÁï≥">${card.level > 0 ? "‚ñº" : ""}</button>
                  <span>${card.icon}</span>
                  <span class="badge" data-status="${card.status}">${card.status}</span>
                  <strong>${card.id}</strong>
                </div>
                <span>‚óè</span>
              </div>
              <div class="card-body">
                <textarea rows="3">${card.text}</textarea>
              </div>
              <div class="card-footer">ÊúÄÁµÇÊõ¥Êñ∞: ${card.updated}</div>
            `;
          if (compact && !matchesFilter && filter) {
            cardEl.classList.add("hidden");
          }
          list.appendChild(cardEl);
        });

        list.dataset.panelId = panel.id;
        panelsContainer.appendChild(panelEl);
      });

      document.getElementById("statusTotal").textContent = `Á∑è„Ç´„Éº„ÉâÊï∞: ${mockPanels.reduce((sum, p) => sum + p.cards.length, 0)}`;
      document.getElementById("statusSelected").textContent = matchedCards.length ? `Ê§úÁ¥¢‰∏ÄËá¥: ${matchedCards.length}` : "ÈÅ∏Êäû„Ç´„Éº„Éâ: -";
      updateTraces();
    }

    function updateTraces() {
      const overlay = document.getElementById("traceOverlay");
      overlay.innerHTML = "";
      if (!document.getElementById("trace-toggle").classList.contains("active")) {
        return;
      }
      const svgNS = "http://www.w3.org/2000/svg";
      const svg = document.createElementNS(svgNS, "svg");
      const defs = document.createElementNS(svgNS, "defs");
      const marker = document.createElementNS(svgNS, "marker");
      marker.setAttribute("id", "arrowhead");
      marker.setAttribute("markerWidth", "6");
      marker.setAttribute("markerHeight", "6");
      marker.setAttribute("refX", "5");
      marker.setAttribute("refY", "3");
      marker.setAttribute("orient", "auto");
      const path = document.createElementNS(svgNS, "path");
      path.setAttribute("d", "M0,0 L6,3 L0,6 z");
      path.setAttribute("fill", "var(--accent)");
      marker.appendChild(path);
      defs.appendChild(marker);
      svg.appendChild(defs);

      traces.forEach((trace) => {
        const fromEl = panelsContainer.querySelector(`.panel[data-panel-id="${trace.fromPanel}"] [data-card-id="${trace.fromId}"]`);
        const toEl = panelsContainer.querySelector(`.panel[data-panel-id="${trace.toPanel}"] [data-card-id="${trace.toId}"]`);
        if (!fromEl || !toEl) return;
        const fromRect = fromEl.getBoundingClientRect();
        const toRect = toEl.getBoundingClientRect();
        const containerRect = panelsContainer.getBoundingClientRect();

        const startX = fromRect.right - containerRect.left;
        const startY = fromRect.top + fromRect.height / 2 - containerRect.top;
        const endX = toRect.left - containerRect.left;
        const endY = toRect.top + toRect.height / 2 - containerRect.top;
        const ctrlOffset = (endX - startX) / 2;

        const bezier = document.createElementNS(svgNS, "path");
        bezier.setAttribute(
          "d",
          `M ${startX} ${startY} C ${startX + ctrlOffset} ${startY}, ${endX - ctrlOffset} ${endY}, ${endX} ${endY}`
        );
        bezier.setAttribute("class", "trace-line");
        svg.appendChild(bezier);
      });

      overlay.appendChild(svg);
    }

    renderPanels();

    window.addEventListener("resize", updateTraces);

    panelsContainer.addEventListener("click", (event) => {
      const button = event.target.closest("button.icon");
      if (!button) return;
      const panelEl = event.target.closest(".panel");
      const action = button.dataset.action;
      if (action === "expand" || action === "collapse") {
        const expanded = action === "expand";
        panelEl.querySelectorAll("textarea").forEach((area) => {
          area.parentElement.parentElement.style.display = expanded ? "" : "none";
        });
      }
      if (button.classList.contains("compact-toggle")) {
        button.classList.toggle("active");
        const isCompact = button.classList.contains("active");
        renderPanels(isCompact, document.getElementById("searchInput").value);
      }
    });

    document.getElementById("searchInput").addEventListener("input", (event) => {
      const query = event.target.value;
      const compact = panelsContainer.querySelector(".compact-toggle")?.classList.contains("active");
      renderPanels(compact, query);
    });

    const logBody = document.getElementById("logBody");
    function renderLog() {
      logBody.innerHTML = "";
      mockLog.forEach((entry) => {
        const line = document.createElement("div");
        line.className = "log-line";
        line.dataset.level = entry.level;
        line.textContent = `[${entry.time}] ${entry.level}: ${entry.message}`;
        logBody.appendChild(line);
      });
    }
    renderLog();

    document.getElementById("clearLog").addEventListener("click", () => {
      logBody.innerHTML = "";
    });

    document.getElementById("trace-toggle").addEventListener("click", (event) => {
      event.currentTarget.classList.toggle("active");
      updateTraces();
    });

    document.getElementById("themeToggle").addEventListener("click", () => {
      document.body.classList.toggle("dark");
      const darkMode = document.body.classList.contains("dark");
      document.getElementById("statusTheme").textContent = darkMode ? "„ÉÄ„Éº„ÇØ„É¢„Éº„Éâ" : "„É©„Ç§„Éà„É¢„Éº„Éâ";
      document.getElementById("statusSave").textContent = darkMode ? "‚úì ‰øùÂ≠òÊ∏à„Åø" : "‚óè Êú™‰øùÂ≠ò";
      updateTraces();
    });
  </script>
</body>
</html>
