# 2025-11-03 作業記録
## P2-05 ショートカットキー実装
- `src/renderer/App.tsx:146-452` に保存状態管理 (`isDirty`/`isSaving`/`lastSavedAt`) と `handleSave`/`handleSplit`/`openSearchPanel`/`useEffect`(グローバル `keydown`) を実装し、`Ctrl+S`/`Ctrl+\\`/`Ctrl+Shift+\\`/`Ctrl+F` を処理。保存API未定義時のガードと保存中の二重起動防止、検索ショートカット時の入力フォーカス制御を追加。
- `src/renderer/App.tsx:640-818` でステータスバーの `saveStatusText`、保存ボタンの `disabled` 制御、`split-grid` の `data-split-mode` とセカンダリパネル表示切替を調整。`src/renderer/styles.css:157-184` へ分割レイアウト/保存ボタンの無効化スタイルを反映。
- `src/shared/workspace.ts:1-90` にカードモデルと `WorkspaceSnapshot`/`isWorkspaceSnapshot`/`CARD_KIND_VALUES` を集約し、`src/main/preload.ts:35-72`・`src/main/main.ts:82-145`・`src/main/workspace.ts:19-190` で `workspace:save/load` IPC を定義。レンダラー保存処理と連携して `_out/workspace.snapshot.json` を読み書きできるようにした。
- `src/renderer/App.tsx:146-838` でスナップショット読み込み時にカードをバリデーションし、無効カードは除外して警告通知・ログ出力を行う処理を追加。`src/renderer/App.test.tsx:49-172` に無効カード除外のテストケースを追加し、`Ctrl+S` 実行時の保存検証も `waitFor` で継続。
- `doc/software_detail_design.md:170-179` の P2-05 節を更新し、保存API導入と関連モジュールへの参照を追記。
- `npm run test:unit` を実行し、全 8 スイート成功を確認。
- `vite.config.ts:1-16` のエイリアスを `src` 直下に変更し、`npm run build` 時の `@/shared` 解決エラーを解消。`npm run build` が成功することを確認。

## P2-05a～P2-05b 残件対応（再帰的分割・パネルクローズ）
- `src/renderer/components/CardPanel.tsx:70-71` に `onPanelClick`/`onPanelClose` プロパティを追加。`handlePanelClick`（89-91行）と `handlePanelClose`（96-102行）コールバックを実装し、パネルクリックで親へ通知、クローズボタンクリック時にイベント伝播を防止。
- `src/renderer/components/CardPanel.tsx:129-138` のタブバー右端に「✕」ボタンを追加。`className="tab-bar__close"` で `handlePanelClose` を呼び出し、`aria-label`/`title` でアクセシビリティ対応。
- `src/renderer/App.tsx:484-495` に `handlePanelClick` を実装し、`setActiveLeaf(leafId)` を呼び出してアクティブ葉ノードを設定、DEBUG ログを出力。
- `src/renderer/App.tsx:501-515` に `handlePanelClose` を実装し、`useSplitStore.getState().removeLeaf(leafId)` でパネル削除、INFO 通知とログを出力。
- `src/renderer/App.tsx:1026-1031` で `SplitContainer` の `renderLeaf` に `onPanelClick`/`onPanelClose` コールバックを渡し、`CardPanel` へ連携。
- `src/renderer/App.tsx:625-652` の `handleSplit` で `activeLeafId ?? splitRoot.id` により、アクティブな葉ノードがあればそれを分割、なければルートを分割する処理に変更。ルート分割済みで未選択時は警告通知・ログ出力。
- `src/renderer/styles.css:198-200` に `.tab-bar__close` スタイルを追加。`hover:bg-rose-100`/`hover:text-rose-700` でホバー時に赤系の背景・文字色を設定、`focus-visible:outline-rose-500` でフォーカス可視化。
- `npm run typecheck`、`npm run build`、`npm run test:unit` を実行し、全 37 テスト成功を確認。再帰的分割とパネルクローズ操作が正常に動作することを検証。
