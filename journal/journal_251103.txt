# 2025-11-03 作業記録
## P2-05 ショートカットキー実装
- `src/renderer/App.tsx:146-452` に保存状態管理 (`isDirty`/`isSaving`/`lastSavedAt`) と `handleSave`/`handleSplit`/`openSearchPanel`/`useEffect`(グローバル `keydown`) を実装し、`Ctrl+S`/`Ctrl+\\`/`Ctrl+Shift+\\`/`Ctrl+F` を処理。保存API未定義時のガードと保存中の二重起動防止、検索ショートカット時の入力フォーカス制御を追加。
- `src/renderer/App.tsx:640-818` でステータスバーの `saveStatusText`、保存ボタンの `disabled` 制御、`split-grid` の `data-split-mode` とセカンダリパネル表示切替を調整。`src/renderer/styles.css:157-184` へ分割レイアウト/保存ボタンの無効化スタイルを反映。
- `src/shared/workspace.ts:1-90` にカードモデルと `WorkspaceSnapshot`/`isWorkspaceSnapshot`/`CARD_KIND_VALUES` を集約し、`src/main/preload.ts:35-72`・`src/main/main.ts:82-145`・`src/main/workspace.ts:19-190` で `workspace:save/load` IPC を定義。レンダラー保存処理と連携して `_out/workspace.snapshot.json` を読み書きできるようにした。
- `src/renderer/App.tsx:146-838` でスナップショット読み込み時にカードをバリデーションし、無効カードは除外して警告通知・ログ出力を行う処理を追加。`src/renderer/App.test.tsx:49-172` に無効カード除外のテストケースを追加し、`Ctrl+S` 実行時の保存検証も `waitFor` で継続。
- `doc/software_detail_design.md:170-179` の P2-05 節を更新し、保存API導入と関連モジュールへの参照を追記。
- `npm run test:unit` を実行し、全 8 スイート成功を確認。
- `vite.config.ts:1-16` のエイリアスを `src` 直下に変更し、`npm run build` 時の `@/shared` 解決エラーを解消。`npm run build` が成功することを確認。
- `task/task_all.md:22-24` に P2-05a/P2-05b を追加完了扱いとし、分割レイアウト再設計タスクを明示。
- `src/renderer/store/panelLayoutStore.ts:1-200` で分割ノードツリー・アクティブパネル・閉じ処理・リサイズ更新を管理するストアを新規実装し、`SplitDirection` 毎にノードを増殖可能とした。
- `src/renderer/components/SplitView.tsx:1-176` を追加し、再帰的に分割ノードを描画。ドラッグリサイズ用のセパレータ、パネルクローズボタン、アクティブハイライトを実装。
- `src/renderer/App.tsx:30-1140` を大幅に整理し、`SplitView` にカードパネル描画を委譲。水平/垂直分割ボタンとショートカットは `handleSplitPanel` でストアに委譲し、旧 `splitMode` ロジックを撤廃。
- `src/renderer/styles.css:157-206` にパネル分割/セパレータ/クローズボタン向けのスタイルを定義し、ドラッグ操作時のカーソルやアクティブリングを調整。
- `src/renderer/App.test.tsx:87-204` を更新し、レイアウト分割の挙動（パネル数、分割方向、クローズ操作）と無効カード除外時の警告表示を検証するテストケースを追加。
- `npm run test:unit` を実行し、23 テストすべてが成功することを確認。
- `src/renderer/styles.css:157-186` の分割グリッドを Flex 配列で再調整し、`split-grid--horizontal` を左右並び (`flex-direction: row`)、`split-grid--vertical` を上下並び (`flex-direction: column`) として再定義。各パネルに `flex: 1 1 0%` を付与し、水平/垂直ボタンの挙動が期待通りになることを確認。
