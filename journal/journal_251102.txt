# 2025-11-02 作業記録
## P0-01 ジャーナル運用開始
- `AGENT.md:6-10` の指示に従い、ジャーナル記録用ディレクトリと当日ファイルを作成。
- 今後の決定事項と根拠を本ファイルに追記する。

## P0-02 Node.js/Electron バージョン決定
- `spec/プロジェクト仕様.md:4-6` に Node.js 22.6.0 (LTS) と Electron ^32.0.0 採用方針を追記し、技術スタックに反映。
- `.nvmrc:1` で開発チームの Node.js バージョンを固定。
- `package.json:1-19` にエンジン要件と Electron 依存バージョンを設定し、`spec/プロジェクト仕様.md` の開発コマンドを実装準備できる状態に整備。

## P0-03 パッケージマネージャ運用方針
- `spec/プロジェクト仕様.md:8-13` の npm コマンド前提に合わせ、標準パッケージマネージャを npm とする方針を決定。
- `CONTRIBUTING.md:1-21` を新規作成し、`npm ci`/`npm install` の利用ルールと `package-lock.json` 管理方針を明文化。

## P0-04 TDD基盤導入
- `package.json:11-20` に Jest/Playwright 用スクリプトを追加し、TDD 実行コマンドを整備。
- `jest.config.cjs:1-11` と `jest.setup.ts:1` を設定し、`src/components/Hello.tsx:1-8`・`src/utils/sum.ts:1-4` のサンプルに対するテスト (`src/components/Hello.test.tsx:1-10`, `src/utils/sum.test.ts:1-7`) を `npm run test:unit` で緑にすることを確認。
- `tests/e2e/smoke.spec.ts:1-5` と `playwright.config.ts:1-19` を用意し、E2E の最小構成を準備。Playwright ブラウザ実体が未インストールの場合は `npx playwright install` を別途実行する必要がある。

## P0-05 Lint/TypeScript 設定
- `.eslintrc.cjs:1-61`, `.eslintignore:1-3`, `.prettierrc.json:1-5`, `.prettierignore:1-3` を追加し、`npm run lint` の成功を確認。
- `tsconfig.json:1-20` を整備し、`npm run typecheck` が成功することを確認。

## P1 課題着手準備
- `npx playwright install chromium` を実行し、ユーザ環境にブラウザバイナリを配置したが、`npm run test:e2e` は Chromium ワーカーが即時終了する問題で失敗。`playwright.config.ts:8-14` に `--no-sandbox` 等を追加しても改善せず、Chromium 単体実行でも `Sandbox(Signal(6))` が発生するため、コンテナの依存パッケージ不足が原因と推定。追加依存の導入には別途権限・調整が必要。
- `node -v` の結果が `v22.20.0` であり、`.nvmrc:1` が指す `22.6.0` と乖離。`nvm` の利用可否を確認し、実行環境を揃える対応が今後必要。

## Node.js バージョン整合
- 実行環境が `node -v` で `v22.20.0` であるため、`.nvmrc:1` と `package.json:7-12` の `engines.node` を `22.20.0` に統一。
- `spec/プロジェクト仕様.md:4-6` も同値に更新し、開発体制で利用する Node.js バージョンを明示。

## E2E テスト暫定対応
- Playwright の Chromium がサンドボックス制約で起動できないため、`playwright.config.ts:1-24` を `--no-sandbox` 等の起動フラグ付き構成に変更。合わせて `tests/e2e/smoke.spec.ts:1-8` を `PLAYWRIGHT_FORCE` 未指定時は自動 skip する形にし、`npm run test:e2e` をサンドボックス非対応環境でも成功させた。
- 環境依存の制約を解消後は `PLAYWRIGHT_FORCE=1 npm run test:e2e` としてブラウザ実行を再開する。
- Playwright をサンドボックス有効で動作させるため、`playwright.config.ts:1-17` を Chromium 標準設定に戻し、`tests/e2e/smoke.spec.ts:1-7` の skip 制御を削除。
- `npm run test:e2e` は `chrome_sandbox` が root 所有 + setuid でないため `Sandbox(Signal(6))` で失敗。
- 解決策として `/home/katsu/.cache/ms-playwright/chromium-1140/chrome-linux/chrome_sandbox` を root:root 所有に変更し `chmod 4755` を適用する必要がある。`sudo chown root:root ... && sudo chmod 4755 ...` を管理者実行すること。
- `chrome_sandbox` に SUID を付与後、`npm run test:e2e` を再実行したが `Sandbox(Signal(6))` のまま失敗。`chrome_sandbox --help` の出力より setuid sandbox API バージョン不一致と `PR_SET_NO_NEW_PRIVS` により権限昇格できていないことを確認。
- WSL2 環境では Chromium setuid sandbox がサポートされないため、サンドボックス稼働には追加のカーネル設定変更や正式サポート環境への移行が必要。現状は `--no-sandbox` 起動を用いるしかない。
