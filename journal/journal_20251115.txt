# ä½œæ¥­è¨˜éŒ² 2025-11-15

## ä½œæ¥­æ¦‚è¦
å³ã‚¯ãƒªãƒƒã‚¯ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’å°‚ç”¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåŒ–ã—ã€ã‚«ãƒ¼ãƒ‰çµ±è¨ˆãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã¨ã‚³ãƒ”ãƒ¼ç³»ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚’å®Ÿè£…ã€‚ä½µã›ã¦ `Card` ãƒ¢ãƒ‡ãƒ«ã« `createdAt` ã‚’å°å…¥ã—ã€è©³ç´°è¨­è¨ˆæ›¸ã‚’æ›´æ–°ã€‚

## å®Ÿæ–½å†…å®¹
### 1. å³ã‚¯ãƒªãƒƒã‚¯ãƒ¡ãƒ‹ãƒ¥ãƒ¼/çµ±è¨ˆãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã®å®Ÿè£…
- `src/renderer/components/ContextMenu.tsx:1-135` ã«æ±ç”¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è¿½åŠ ã€‚è¡¨ç¤ºä½ç½®è£œæ­£ã¨å¤–å´ã‚¯ãƒªãƒƒã‚¯/ESCã‚¯ãƒ­ãƒ¼ã‚ºã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³/ã‚¢ã‚¤ãƒ†ãƒ ã® Variantãƒ»Disable åˆ¤å®šã‚’å®Ÿè£…ã€‚
- `src/renderer/components/CardPanel.tsx:600-930` ã§ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼åˆ¶å¾¡ã‚’åˆ·æ–°ã€‚`contextMenuSections` ã«ç·¨é›†/è¿½åŠ /è²¼ã‚Šä»˜ã‘/æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ§‹æˆã—ã€`copyPlainText`ãƒ»`handleCopyCardsAsText`ãƒ»`handleCopyCardUuid` ã§ã‚«ãƒ¼ãƒ‰æœ¬æ–‡/UUID ã‚³ãƒ”ãƒ¼ã‚’æä¾›ã€‚`CardStatsDialog` ã‚’é–‹ããƒãƒ³ãƒ‰ãƒ©ã‚„ `statsTargetCardId` ç®¡ç†ã‚‚è¿½åŠ ã€‚
- `src/renderer/components/CardStatsDialog.tsx:1-120` ã«çµ±è¨ˆãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’æ–°è¨­ã—ã€ã‚«ãƒ¼ãƒ‰ID/UUID/ç¨®åˆ¥/ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹/ä½œæˆãƒ»æ›´æ–°æ—¥æ™‚/ãƒˆãƒ¬ãƒ¼ã‚¹ä»¶æ•°/éšå±¤/æ–‡å­—æ•°ãƒ»å˜èªæ•°ãƒ»è¡Œæ•°ã‚’è¡¨ç¤ºã€‚
- `src/renderer/constants/cardPresentation.ts:1-46` ã§ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹/ç¨®åˆ¥ãƒ©ãƒ™ãƒ«ã¨ã‚¢ã‚¤ã‚³ãƒ³ã‚’ä¸€å…ƒåŒ–ã—ã€`CardPanel`/`CardStatsDialog` åŒæ–¹ã§åˆ©ç”¨ã€‚
- `src/renderer/utils/cardUtils.ts:1-57` ã« `CardContentStatistics` ã¨ `calculateCardContentStatistics` ã‚’å®Ÿè£…ã€`src/renderer/utils/__tests__/cardUtils.test.ts:1-32` ã§å˜ä½“ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ ã€‚
- `src/renderer/styles.css:513-548,1287-1345` ã¸ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãƒ©ãƒ™ãƒ«/ã‚¢ã‚¤ã‚³ãƒ³/ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã¨çµ±è¨ˆãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’è¿½åŠ ã—ã€ãƒ©ã‚¤ãƒˆ/ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒã§è¦–èªæ€§ã‚’æ•´ãˆãŸã€‚

### 2. ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ã¨ç”Ÿæˆå‡¦ç†ã®æ‹¡å¼µ
- `src/shared/workspace.ts:60-140` ã« `Card` ã® `createdAt?: string` ã‚’è¿½åŠ ã—ã€`isWorkspaceSnapshot` ã§å‹ãƒã‚§ãƒƒã‚¯ã‚’æ‹¡å¼µã€‚
- `src/renderer/store/workspaceStore.ts:636-660,1764-1786` ã§ `addCard` ã¨ `materializeClipboardNode` ãŒ `createdAt`/`updatedAt` ã‚’åŒä¸€ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã§æ¡ç•ªã™ã‚‹ã‚ˆã†æ›´æ–°ã€‚è²¼ã‚Šä»˜ã‘ç”Ÿæˆã‚«ãƒ¼ãƒ‰ã«ã‚‚åæ˜ ã€‚

### 3. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°
- `doc/software_detail_design.md:3` ã§æœ€çµ‚æ›´æ–°æ—¥ã‚’ 2025-11-15 ã«æ›´æ–°ã€‚
- åŒãƒ•ã‚¡ã‚¤ãƒ« `:314` ã« `createdAt` è¿½åŠ ã¨æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®æ‰±ã„ã‚’è¿½è¨˜ã—ã€`:333-340` ã« P6-06ï¼ˆå³ã‚¯ãƒªãƒƒã‚¯ãƒ¡ãƒ‹ãƒ¥ãƒ¼/çµ±è¨ˆãƒ€ã‚¤ã‚¢ãƒ­ã‚°æ‹¡å¼µï¼‰ã®è¨­è¨ˆæ¦‚è¦ã‚’è¿½åŠ ã€‚

## æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
- Jest ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã€ContextMenu/çµ±è¨ˆæ©Ÿèƒ½è¿½åŠ å¾Œã®ãƒªã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³ã‚’ç¢ºèªã™ã‚‹ã€‚
- ã‚«ãƒ¼ãƒ‰å³ã‚¯ãƒªãƒƒã‚¯æ™‚ã«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒå³æ™‚ã‚¯ãƒ­ãƒ¼ã‚ºã—ã¦ã„ãŸãŸã‚ã€`ContextMenu` ã® `contextmenu` ãƒªã‚¹ãƒŠãƒ¼ã‚’å‰Šé™¤ã—ã€`mousedown` ãƒ™ãƒ¼ã‚¹ã®é–‰ã˜å‡¦ç†ã«çµ±ä¸€ã—ãŸï¼ˆWSL ç’°å¢ƒå«ã‚ã¦è¡¨ç¤ºãŒå®‰å®šï¼‰ã€‚
- ãƒ•ãƒ¥ãƒ¼ãƒãƒ£ãƒ¼æ©Ÿèƒ½11ã€Œã‚«ãƒ¼ãƒ‰çµ±åˆã€ã‚’å®Ÿè£…ã€‚`workspaceStore.mergeCards`ï¼ˆ`src/renderer/store/workspaceStore.ts:600-760` ä»˜è¿‘ï¼‰ã§åŒä¸€éšå±¤ã‹ã¤é€£ç¶šã™ã‚‹ã‚«ãƒ¼ãƒ‰ã®ã¿çµ±åˆå¯èƒ½ã¨ã—ã€Undo/Redo ã¨ `dirtyCardIds` ã‚’æ›´æ–°ã€‚`CardPanel.tsx:830-1180` ã« ğŸ§© ãƒœã‚¿ãƒ³/ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼é …ç›®/ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºã‚’è¿½åŠ ã—ã€`CardMergeDialog.tsx` ã§ã‚¿ã‚¤ãƒˆãƒ«ãƒ»æœ¬æ–‡ãƒ»ã‚«ãƒ¼ãƒ‰IDãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ç·¨é›†ã§ãã‚‹UIã‚’æä¾›ã—ãŸã€‚`CardPanel` å†…ã® `reassignTracesForMerge` ã§ `useTraceStore.saveRelationsForPair` ã‚’å‘¼ã³å‡ºã—ã€ãƒ­ãƒ¼ãƒ‰æ¸ˆã¿ãƒˆãƒ¬ãƒ¼ã‚¹ã«é™ã‚Š left/right IDs ã‚’çµ±åˆã€‚`styles.css:1287-1350` ã«å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ«ã€`doc/software_detail_design.md` ã¨ `doc/implementation_plan_future_features.md` ã‚’æ›´æ–°ã€`workspaceStore.test.ts` ã«çµ±åˆã®å˜ä½“ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ ã€‚

## è¿½åŠ ä½œæ¥­ (Phase0 ãƒˆãƒ¬ãƒ¼ã‚¹ãƒãƒˆãƒªã‚¯ã‚¹æº–å‚™)
- `src/shared/workspace.ts:33-140` ã§ `CardStatus` ã« `deprecated` ãŒå«ã¾ã‚Œã€`Card` ã« `cardId` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã€‚`src/shared/conversion/pipeline.ts:12-138` ã¨ `src/renderer/components/ConversionModal.tsx:191-304` ã§ã‚«ãƒ¼ãƒ‰IDè‡ªå‹•ä»˜ä¸UI/ãƒ­ã‚¸ãƒƒã‚¯ãŒæƒã£ã¦ã„ã‚‹ãŸã‚ã€Phase3.1ã®å‰ææ¡ä»¶ãŒæº€ãŸã•ã‚Œã¦ã„ã‚‹ã¨åˆ¤æ–­ã€‚
- `src/renderer/components/CardPanel.tsx:647-713,1906-1970` ã«ã¦ã‚«ãƒ¼ãƒ‰IDä¸€æ‹¬æ¥é ­èªå¤‰æ›´/ç›´æ¥ç·¨é›†ã€`src/renderer/styles.css:868-887` ã«ã¦ `deprecated` ãƒãƒƒã‚¸é…è‰²ã€`src/renderer/components/CardPanel.tsx:505-512` ã«ã¦æœªãƒˆãƒ¬ãƒ¼ã‚¹é›†è¨ˆã‹ã‚‰å»ƒæ­¢ã‚«ãƒ¼ãƒ‰ã‚’é™¤å¤–ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã€‚
- `src/renderer/store/traceStore.ts:1-386` ã‚’èª¿æŸ»ã—ã€ãƒˆãƒ¬ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ­ãƒ¼ãƒ‰/ä¿å­˜ã€é–¢é€£ã‚«ãƒ¼ãƒ‰é›†è¨ˆAPIï¼ˆ`getRelatedCards`, `getCountsForFile` ç­‰ï¼‰ãŒç¾åœ¨ã®ã‚«ãƒ¼ãƒ‰ä¸€è¦§ã¨ã‚³ãƒã‚¯ã‚¿æç”»ã§åˆ©ç”¨å¯èƒ½ã«ãªã£ã¦ã„ã‚‹çŠ¶æ³ã‚’æ•´ç†ã€‚ãƒãƒˆãƒªã‚¯ã‚¹å°‚ç”¨ã® `getTraceMatrix` ã¯æœªå®Ÿè£…ã§è¿½åŠ ãŒå¿…è¦ã€‚
- `npm run test:unit` ã‚’å®Ÿè¡Œã—ãŸã¨ã“ã‚ `src/renderer/store/workspaceStore.test.ts:779-834` ã§ `mergeCandidates` æœªå®šç¾©ã‚„ `result` æœªåˆæœŸåŒ–ã«ã‚ˆã‚‹TypeScriptã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã€ã‚¹ã‚¤ãƒ¼ãƒˆå…¨ä½“ãŒåœæ­¢ã€‚æ—¢å­˜èª²é¡Œã¨ã—ã¦è¨˜éŒ²ï¼ˆä¿®æ­£ã¯æœªå¯¾å¿œï¼‰ã€‚

## æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
- workspaceStoreã®ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿å®šç¾©ã‚’ä¿®æ­£ã—ã¦`npm run test:unit`ã‚’ãƒ‘ã‚¹ã•ã›ã‚‹ã€‚
- TraceMatrixå‘ã‘ã«`traceStore`ã¸ãƒãƒˆãƒªã‚¯ã‚¹å–å¾—APIã‚’è¨­è¨ˆã—ã€IPC/ã‚¹ãƒˆã‚¢æ•´å‚™(Phase1)ã«ç€æ‰‹ã€‚

## Phase1ç€æ‰‹ãƒ­ã‚°
- `src/renderer/store/workspaceStore.test.ts` ã® `mergeCards` ãƒ†ã‚¹ãƒˆç¾¤ã§ `mergeCandidates` ãŒ describe ãƒ–ãƒ­ãƒƒã‚¯å¤–ã‹ã‚‰å‚ç…§ã§ããšå‹æ¨è«–ã‚‚ç ´ç¶»ã—ã¦ã„ãŸãŸã‚ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¹ã‚³ãƒ¼ãƒ—ã«ç§»å‹•ã—ã€`WorkspaceStore['mergeCards']` ç”±æ¥ã® `MergeCardsReturn` å‹ã‚’å°å…¥ã€‚`npm run test:unit` ãŒæˆåŠŸã™ã‚‹ã“ã¨ã‚’ç¢ºèªã€‚
- `src/main/main.ts` / `src/main/preload.ts` ã‚’å†ç¢ºèªã—ã€ç¾çŠ¶IPCã¯ãƒ¡ã‚¤ãƒ³ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®ã¿ã‚’å¯¾è±¡ã« `workspace:*` / `history:*` / `document:*` ãªã©ã‚’ expose ã—ã¦ã„ã‚‹ã“ã¨ã‚’æ•´ç†ã€‚ãƒãƒˆãƒªã‚¯ã‚¹æ©Ÿèƒ½ã§ã¯ã“ã“ã« `matrix:open`/`matrix:close`/`trace:changed`/`card-selection:changed` ã‚’è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚
- Phase1ã§ã¯ `main/matrixWindowManager.ts`ï¼ˆBrowserWindowç”Ÿæˆãƒ»ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆç®¡ç†ï¼‰ã¨ `renderer/store/matrixStore.ts`ï¼ˆã‚¦ã‚£ãƒ³ãƒ‰ã‚¦çŠ¶æ…‹ï¼‹IPCãƒ•ãƒƒã‚¯ï¼‰ã‚’æ–°è¨­ã™ã‚‹æ–¹é‡ã§ã€æ—¢å­˜ `traceStore` ã¯ `getTraceMatrix` ç›¸å½“ã®ãƒ‡ãƒ¼ã‚¿ç”ŸæˆAPIã‚’æ‹¡å¼µã™ã‚‹è¨ˆç”»ã€‚
- å®Ÿè£…æ¸ˆã¿: `src/main/matrixWindowManager.ts` ã¨ `matrix:open/close` IPC ã‚’è¿½åŠ ã—ã€preload/global.d.ts ã§ `window.app.matrix` API ã‚’å…¬é–‹ã€‚`src/renderer/store/matrixStore.ts` ã¨ `src/renderer/hooks/useMatrixIPC.ts` ã§åˆæœŸãƒ‡ãƒ¼ã‚¿ãƒ­ãƒ¼ãƒ‰ãƒ»ãƒã‚¤ãƒ©ã‚¤ãƒˆæ›´æ–°ãƒ»beforeunloadæ™‚ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚’å®Ÿè£…ã—ã€`npm run test:unit` ã§ãƒªã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³ç¢ºèªæ¸ˆã¿ã€‚

## Phase2ãƒ­ã‚°
- `src/renderer/MatrixApp.tsx` ã¨ `src/renderer/main.tsx` ã‚’æ›´æ–°ã—ã€`#matrix` ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§ã¯å°‚ç”¨UIã‚’æç”»ã™ã‚‹ã‚ˆã†åˆ†é›¢ã€‚`MatrixApp` å†…ã§ `useMatrixIPC` ã‚’èµ·å‹•ã—ã€ãƒ­ãƒ¼ãƒ‰ãƒ»ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã‚’æ‹…å½“ã€‚
- `TraceMatrixDialog/Header/Toolbar/Cell` ã‚’å®Ÿè£…ã—ã€CSS Grid ãƒ™ãƒ¼ã‚¹ã®2Dã‚°ãƒªãƒƒãƒ‰ã§è¡Œ/åˆ—ãƒ˜ãƒƒãƒ€ãƒ»ã‚»ãƒ«æ“ä½œãƒ»çµ±è¨ˆãƒãƒ¼ã‚’è¡¨ç¤ºã€‚ã‚»ãƒ«ã‚¯ãƒªãƒƒã‚¯ã§ `toggleTraceRelation`ã€å³ã‚¯ãƒªãƒƒã‚¯ã§ `TRACE_RELATION_KINDS` ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¡¨ç¤ºã€‚
- `src/renderer/store/matrixStore.ts` ã«ãƒˆãƒ¬ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«å/ãƒ˜ãƒƒãƒ€ç®¡ç†ã¨ stats æ›´æ–°ã‚’è¿½åŠ ã—ã€`TraceMatrixDialog` ã‹ã‚‰`window.app.workspace.saveTraceFile` + `window.app.matrix.broadcastTraceChange` ã‚’å‘¼ã¹ã‚‹ã‚ˆã†æ•´å‚™ã€‚`src/renderer/hooks/useMatrixIPC.ts` ã¯ `loadTraceFile` ã‹ã‚‰å¾—ãŸãƒ¡ã‚¿æƒ…å ±ã‚’ã‚¹ãƒˆã‚¢ã¸åæ˜ ã€‚
- `src/renderer/utils/matrixRelations.ts` ã¨Jestãƒ†ã‚¹ãƒˆã‚’è¿½åŠ ã—ã€ã‚»ãƒ«å˜ä½ãƒˆã‚°ãƒ«/ç¨®åˆ¥å¤‰æ›´ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’å˜ä½“ãƒ†ã‚¹ãƒˆã§æ‹…ä¿ã€‚
- `src/renderer/styles.css` ã«ãƒˆãƒ¬ãƒ¼ã‚¹ãƒãƒˆãƒªã‚¯ã‚¹ç”¨ã‚¹ã‚¿ã‚¤ãƒ«ã‚’è¿½åŠ ã—ã€æç¤ºã•ã‚ŒãŸimage.pngã®ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰é…è‰²/ã‚»ãƒ«è‰²åˆ†ã‘ã‚’å†ç¾ã€‚
