# アプリケーション仕様書

## 1. プロジェクト概要
### 1.1. 概要
既存の大規模PJでは、設計情報が自然言語文書で散在・連携は人手依存であり、生成AIの適用範囲がコード周辺に限定されがちである。

本アプリケーションは、仕様書／設計書／議事録等の自然言語の文書から成る非構造化情報を、「カード」に分割する。
文書内の「カード」間の関係は構造的(順序・グループ化・階層化）に管理し、「カード」の内容、および「カード」間の関係を編集できる。
文書間の「カード」のトレーサビリティを編集、管理できる。

本アプリを利用することにより
- 仕様／設計／設計経緯の非構造化→構造化データ変換
- デジタル空間での情報連携（トレーサビリティ）
を推進し、生成AI活用の適用範囲を上流工程に拡張する。

本アプリは次の2機能から成る。
- 共通機能: ファイル入出力、ログ管理、設定管理
- カード変換機能: テキストから「カード」を生成
- カード編集機能: カード内容・順序・階層・関係（トレーサビリティ）の編集

管理情報はJSON形式で保存し、他ツールとの連携を容易にする。

## 2. 共通機能
### 2.1. 機能要件
- **ファイル入出力**:
  - 入力: テキストファイル（`.txt`, `.md`）。UTF-8を既定。SJIS/CP932は自動変換。
  - 出力: カードファイル（JSON）、トレーサビリティ情報ファイル（JSON）。
  - ファイルダイアログでの選択、ドラッグアンドドロップに対応。
  - 複数タブ/パネルでの同時編集をサポート。
- **ログ管理**:
  - 動作ログをファイルに保存。ログレベル設定（info/warn/error/debug）対応。
  - ログローテーション（サイズ/世代/日数）対応。
- **設定管理**:
  - パラメータファイル（JSON）で各種設定を管理。
  - 設定変更は即時反映。UIからの編集もサポート。

### 2.2. 非機能要件
- **性能要件**:
  - ファイル入出力: 5,000カードで < 1s を目安。
  - ログ書込: 100ms以内。
  - 設定反映: 500ms以内。
- **信頼性要件**:
  - 入出力エラー時はユーザ通知とログ記録。
  - 設定ファイル破損時は既定値で復元し、ユーザ通知。
- **操作性要件**:
  - ショートカットキーでの操作を可能とする。
  - パラメータファイル（JSON）で設定をカスタマイズ可能。
  - 設定変更は即時反映。UIからの編集もサポート。
- **視認性要件**:
  - ライト／ダーク／システムのテーマカラーを設定可能とする。
  - パラメータファイル（JSON）で設定をカスタマイズ可能。
  - 設定変更は即時反映。UIからの編集もサポート。
- **拡張性要件**:
  - 将来のファイル形式追加を考慮した設計。

## 3. カード変換機能
### 3.1. 機能要件

- **入力仕様**:
  - テキスト（`.txt`, `.md`）。UTF-8を既定。SJIS/CP932は自動変換。
  - 10MB超は警告ダイアログ表示し、処理継続/キャンセルを選択可能。

- **変換仕様**:
  - 変換方式設定に従い分割/階層化をモジュール化し、設定で切替可能。

  - 共通ルール
    - 作成するカードは入力文書の順序を保持。
	- 箇条書き(番号あり／なし)は別カードとして分割する。
	- 段落が異なる場合は別カードとして分割する。
    - 図情報（PlantUML等）は、図および図番号をひとまとまりのカードとする。
	- 表情報は、表および表情報をひとまとまりのカードとする。
	- 試験情報は、試験番号(手順や試験規格含む)をひとまとまりのカードとする。
	- QA情報は、QA番号(Question/Answerのセット含む)をひとまとまりのカードとする。
    - 階層付与
      - Markdownファイル(`.md`)の場合: 見出しレベル（`#`, `##`, `###`等）により、階層構造を判断する。
      - テキストファイル(`.txt`)の場合: インデント深さや番号体系（例: 1., 1.1., 1.1.1.）により、階層構造を判断する。

  - 変換方式 
    - 固定ルールによる変換: 共通ルールに従い、カード分割する。
    - LLMによる変換: LLM（OpenAI/Gemini/Ollama等のAPI設定を可能とする）を使用し共通ルールに従いカード分割する。`temperature=0` を既定（冪等性確保）。

- **出力仕様**:
  - カードファイル（JSON）として保存。

- **動作ログ仕様**:
  - 変換処理開始/終了/警告/エラーを記録。LLM使用時はプロバイダとトークン概数を匿名で記録。

### 3.2. 非機能要件
 - 変換処理中も他タブ/カード編集操作を可能にする（非同期処理）。
 - 変換処理はキャンセル可能。中断時は部分結果をロールバック。
 - 異常発生時は最前面ダイアログで通知し、ログに詳細を記録。


## 4. カード編集機能
### 4.1 機能要件
- **編集仕様**:
  - 各カードは階層関係(親子関係)、順序関係(兄弟関係における順序性)を持つ。
  - 階層関係と順序関係はユーザ操作で任意に編集可能とする。
  - 新規のカードを任意の位置に追加可能とする。
  - 任意のカードを削除可能とする。
  - カードの階層や位置（順序）を移動可能とする。階層関係を持つ場合、移動対象の子にあたる構造も一緒に移動する。
  - カード移動をしても、個別のカードが持つトレース情報はそのまま保持する。
  - 同じ階層のカードは、複数同時に選択して移動可能とする。
  - カード内の情報を編集可能とする。
  - 保存操作をするまではインメモリの情報を更新し、保存操作のタイミングでファイル保存する。
  - 未保存中の終了/タブクローズ時は確認ダイアログを出し、保存忘れを防止。
  - カード移動、カード内編集操作に対するUndo/Redoを可能とする。履歴深度の目安は 1,000。
  - Undo/Redoの対象は、選択中のカードファイルのみ／全カードファイル　を選択可能。
  - クローズ済みファイルに対するUndo/Redoは、ファイル再オープンした上で適用する。
  - 保存済み情報に対してUndo/Redoとなる場合はインメモリ情報を更新し、保存操作のタイミングでファイル保存する。

- **内部の情報管理方法**:
  - 各カードは階層関係(親子関係)、順序関係(兄弟関係における順序性)を持つ。
  - 階層構造は`parent_id`/`child_ids[]`で管理し、順序関係は`prev_id`/`next_id`の双方向リンクで管理する。
  - これらの情報は、ファイル読み込み時にメモリに読込する(操作性を確保するため)。
  - 複数パネル/タブで同一ファイルが開かれても、単一のインメモリ情報を共有し、操作に対するUIへの反映は同期する。
  - 外部でファイル変更があった場合は検知し、再読込の確認ダイアログを表示する。再読み込みした場合は、未保存の編集情報は消える。

- **トレーサビリティ情報の管理**:
  - トレーサビリティは有指向の情報を持つ。
  - カード間（カードファイル内およびカードファイル間のどちらも）のトレーサビリティ情報を編集可能とする。
  - トレーサビリティ情報の編集は、トレーサビリティ対象のカードファイルに対する編集操作がすべて保存完了している場合に可能とする。よって編集中のカードファイルへのトレーサビリティを追加／削除しようとすると操作不可のダイアログを出す。
  - トレーサビリティ情報は即時反映とし、操作時点でトレーサビリティ情報をファイル保存する。

- **検索/置換仕様**:
  - カードに対する検索/置換の範囲は、カードファイル内、開いている全カードファイル、指定したフォルダとサブフォルダを含むすべてのカードファイルを選択可能。
  - カードに対する検索は文字列検索と、正規表現を選択可能とする。

- **表示フィルタ**
  -カードに対する検索/置換対象をフィルタ可能とする。フィルタはカード情報種別、選択中カードとトレーサビリティ関係 を組み合わせ可能。
  -フィルタの結果、階層が下のカードが対象となった場合は、そのカードに紐づく親階層のカードも表示する。

### 4.2 非機能要件
- 性能要件:
  - 最大カードファイル数: 32ファイルを快適に操作可能。
  - 最大カード数: 10,000件を快適に操作可能。
  - 表示応答性: 全てのUI要素を表示させた場合の編集操作や画面分割、スクロール等の操作がスムーズであること。
  - 起動/初回読込: < 2s（1,000カード）、< 8s（10,000カード）を目安。
  - 保存時間: 5,000カードで < 1s を目安。

## 5. ファイル仕様
以下は本アプリで扱う主要なファイル種別とその仕様の概要である。
**実行時のフォルダ・ファイル構成**：
```
   {workDir}/
	 |_ settings.json          // パラメータファイル
	 |_ _input/                // 入力フォルダ
	 |	|_ <inputfile>_yyyyMMdd_HHmmss.txt/md    // 入力ファイルのコピー（日時付き）
	 |_ _out/                  // 出力フォルダ（カードファイル、トレーサビリティ情報ファイル）
	 |	|_ <inputfile>_<label>.json  // カードファイル（<label>が空の場合は<inputfile>.json）
	 |	|_ trace_<left>_<right>.json // トレーサビリティ情報ファイル
	 |_ _logs/                 // ログフォルダ（動作ログファイル）
	 |	|_ yyyyMMdd_HHmmss.log       // 動作ログファイル
```
### 5.0 ファイル一覧（概要）

- パラメータファイル
  - ファイル名: `settings.json`
  - 目的: アプリの各種設定を管理

- 入力ファイル
  - 対応拡張子: `.txt`, `.md`
  - 文字コード: UTF-8（BOM有無どちらも可）。CP932/SJISは自動判別してUTF-8に変換。その他はエラー。
  - 改行: `\n` / `\r\n` を許容し、内部では正規化する。
  - 入力サイズ: 10MB超は警告ダイアログを表示し、処理継続／キャンセルをユーザが選択可能。200MB超はエラーとし処理を中断。
  - 内容: 仕様／設計／設計経緯などのテキスト情報（画像は対象外）
  - コピー保存: 入力ファイルは`_input/`フォルダに`<inputfile>_yyyyMMdd_HHmmss.txt/md`の形式でコピー保存される。

- カードファイル
  - ファイル名: `<inputfile>_<label>.json` または `<inputfile>.json`
  - 目的: 構造化されたカード情報を保持（JSON）
  - `<label>`は、ファイル保存時にユーザが任意に指定可能。指定がなければ`<inputfile>.json`となる（アンダースコアなし）。

- トレーサビリティ情報ファイル
  - ファイル名: `trace_<left>_<right>.json`
  - 目的: 2つのカードファイル間のトレーサビリティ情報を保持（JSON）
  - `<left>`と`<right>`はカードファイル名（拡張子`.json`を除く）
  - 例: カードファイルが`spec_v1.json`と`design_v1.json`の場合、トレーサビリティファイルは`trace_spec_v1_design_v1.json`となる

- 動作ログファイル
  - ファイル名: `yyyyMMdd_HHmmss.log`
  - 目的: アプリの動作ログを保存
  - フォーマット: 年月日と時分秒をアンダースコアで区切る

### 5.1 パラメータファイル

パラメータファイル（`settings.json`）は、アプリの挙動や出力先などを定義する設定ファイルです。主な設定項目は以下の通りです。

#### ファイル入力
- `input.maxWarnSizeMB`: 警告を出すファイルサイズ閾値（既定: 10）
- `input.maxAbortSizeMB`: 入力ファイルの最大許容サイズ（既定: 200）
- `file.encodingFallback`: 自動判別失敗時の扱い（`reject` | `assume-sjis` | `assume-utf8`）
- `file.normalizeNewline`: 改行コードの正規化（`true` | `false`）

#### 変換方式
- `converter.strategy`: 変換方式（`rule` | `llm`）
- `converter.timeoutMs`: 変換処理タイムアウト（`none` | `<number>`、既定: 60000）

#### LLM 設定
- `llm.provider`: LLMプロバイダ（`openai` | `gemini` | `ollama` | `none`）
- `llm.endpoint`: カスタムエンドポイント
- `llm.model`: 使用モデル名
- `llm.temperature`: 生成温度（既定: 0）
- `llm.maxTokens`: 最大トークン数
- `llm.allowCloud`: クラウドLLM利用可否（`true` | `false`、既定: `false`）
- `llm.redaction.enabled`: 固有名詞／数値の匿名化（`true` | `false`）
- `llm.apiKey`: APIキー
- `llm.timeoutMs`: APIタイムアウト
- `llm.maxConcurrency`: 最大同時実行数

#### ログ
- `log.logLevel`: ログレベル（`info` | `warn` | `error` | `debug`、既定: `info`）
- `log.logRotation`: ログローテーション設定（`{ maxFileSizeMB, maxFiles, retentionDays }`）

#### 自動保存／履歴／UndoRedo
- `history.maxDepth`: Undo/Redo履歴の最大深度（既定: 1000）
- `history.perFile`: 履歴スコープ（ファイル単位、`true` | `false`）
- `history.persistOnExit`: 終了時履歴保存（`true` | `false`）
- `ui.autoSave.enabled`: 自動保存有効化（`true` | `false`）
- `ui.autoSave.intervalMs`: 自動保存間隔（ミリ秒）

#### UI／表示設定
- `ui.theme`: テーマ（`light` | `dark` | `system`）
- `ui.locale`: ロケール
- `ui.font.family`: フォントファミリー
- `ui.font.size`: フォントサイズ
- `ui.window.startMaximized`: 起動時最大化（`true` | `false`）
- `ui.window.bounds`: ウィンドウサイズ・位置
- `ui.tab.maxWidth`: タブ最大幅
- `ui.tab.height`: タブ高さ
- `ui.highlightColors`: ハイライト色（`selected`／`edited`／`traceHighlight`）

#### トレーサビリティ
- `trace.defaultDirection`: デフォルト方向（例: `bidirectional`）
- `trace.highlightColors`: ハイライト色（`selected`／`traceHighlight`）

#### ファイル監視／外部変更
- `fileWatcher.enabled`: ファイル監視有効化（`true` | `false`）
- `fileWatcher.debounceMs`: 監視ディレイ（ミリ秒）
- `fileWatcher.autoReloadPolicy`: 外部変更時の挙動（`prompt` | `auto` | `ignore`）
- `fileWatcher.ignorePatterns`: 監視除外パターン

#### 検索／置換
- `search.defaultRegex`: デフォルト正規表現（`true` | `false`）
- `search.maxResults`: 最大検索結果数
- `search.caseSensitiveDefault`: デフォルト大文字小文字区別

#### 同時編集／ロック
- `concurrency.fileLocking`: ファイルロック方式（`optimistic` | `pessimistic` | `none`）
- `concurrency.maxOpenFiles`: 最大同時オープンファイル数（既定: 32）

#### その他運用
- `recentFiles.limit`: 最近使ったファイルの最大記録数
- `ui.shortcuts`: カスタムショートカット定義オブジェクト

### 5.2 入力ファイル
本アプリの入力ソース。読み込み時にエンコーディングを判別し、内部表現へ正規化する。

### 5.3 カードファイル
カードファイルは JSON 形式で保存され、データモデル（第7章）に準拠する。最低限含む項目:

- `schemaVersion`（例: `1`）
- `updatedAt`（ISO 8601）
- `source`: 読み込み元ファイル情報の要約
- `cards[]`: カード配列（第7章参照）

### 5.4 トレーサビリティ情報ファイル
トレーサビリティ情報ファイルは、2つのカードファイル間の関係（トレーサビリティ）を保持する。左右は単なる識別子で、上下関係を意味しない。

- `left_file`
- `right_file`
- `relations[]`: `{ left_ids[], right_ids[], type, directed, memo }`
- `directed`: `left_to_right` | `right_to_left` | `bidirectional`
- `type`: `trace` | `refines` | `tests` | `duplicates` | `satisfy` | `relate` | `specialize`（将来拡張可）

### 5.5 動作ログファイル
動作ログファイルには、発生時刻、ログレベル、メッセージ、スタック情報（ある場合）を出力する。ログレベルは `info` | `warn` | `error` | `debug`。

## 6 UI/UX仕様
### 6.1 全体レイアウト
- **メニューバー**:
1.  ファイル(F)(ファイルを開く、上書き保存、名前を付けて保存、アプリケーションの終了)
2.  編集(E)(Undo、Redo、設定)
3.  表示(V)(エクスプローラ、検索／置換、カード変換画面、カード編集画面、動作ログ画面)
4.  ヘルプ(H)(操作方法、バージョン情報)

- **ツールバー**:
アイコン表示する。
- ファイルを開く、上書き保存
- トレーサビリティのコネクタ表示有無のトグルボタン
- トレースタイプフィルタ（ドロップダウン表示し、トレースタイプ毎にチェックボックスON/OFF）
- パネル分割（水平分割、垂直分割）

- **メインエリア**:
- 1. サイドバー(左パネル)
	エクスプローラ
	検索／置換
- 2. メイン(右パネル)
	- 1. メイン(右上パネル)
		カード編集画面
	- 2. ログ(右下パネル)
		3.  動作ログ
- **ステータスバー**: 選択文書の全カード数、選択中のカード番号

- 操作中の画面・ダイアログとは関係のないメニューは、無効表示として選択不可とする。
- メインエリアの左右／上下のサイズは任意に変更可能とする。

### 6.2 ファイルを開くダイアログ
**レイアウト**
- ファイルパスのテキストボックス
- [参照]ボタン: エクスプローラからファイル選択可能とする
- 変換方法のラジオボタン: `rule` | `llm`
- [変換][キャンセル]ボタン

**動作**
- [変換]ボタン押下により、変換中画面となり他の操作は不可。進捗表示。
- 変換完了により、カード編集画面となる。

### 6.3 カード編集画面
- カードファイル情報の表示をカードパネルと呼ぶ。
- カード編集画面は水平方向、垂直方向に、スプリット操作履歴に基づく再帰的グリッド構造とする（VSCodeのような分割の考え方）。分割されたグリッドを分割ノードと呼ぶ。
- 分割ノード上部にはカードファイル名をタブ表示する（タブバー）。
- 分割ノード内には、カードパネルツールバーとカードパネルを表示する。
- カード編集画面は上下方向、左右方向にそれぞれ任意の分割数で分割でき、任意の位置にカードパネルを割り当て可能とする。
- 同じ位置に複数のカードファイル情報を割り当てることを可能とする。
- 同じカードパネルを、複数の分割領域に割り当てることを可能とする。
- メニュー／ツールバーの操作は、基本的にはアクティブのカードパネルに対する操作となる。
- エクスプローラから、任意の分割領域へドラッグアンドドロップにより、カードパネルを開くことが可能。
- エクスプローラからカードファイルを開くと、アクティブカードパネルの位置の領域に開く。
- 編集が未保存のカードは視覚的に識別可能とする。

- 左右方向に隣り合ったカードパネルに対してトレーサビリティ情報があれば、視覚でわかるようにコネクタ表示を行う。
	- 例えば、左パネルが上下2分割、右パネルが上下2分割の場合、左上-右上、左上-右下、左下-右上、左下-右下の4通りの組合せでトレーサビリティ情報を表示する。
- コネクタは、トレーサビリティ情報が存在するカード間のみ表示する。
- コネクタは有向性を矢印で表現（片方向/双方向/方向なし）。
- コネクタのスタイルはカスタマイズ可能（有向/色/太さ/実線・破線・点線/コネクタ上のテキスト有無）。
- トレース関係にある２つのカード情報が全く同じ場合は、その他のコネクタと視覚的に識別可能とする(他とは別のコネクタ設定とする)。
- コネクタ(トレーサビリティ情報)をUI上から操作（作成、変更、削除）可能とする。
	- 作成: ドラッグでカード間コネクタを生成可能とする。
	- 変更: コネクタ端をドラッグして変更可能とする。
	- 削除: コネクタを選択して削除する。
- カード移動操作が視覚的にわかるような視覚効果を具備する。
- 選択中のカードに対して、トレーサビリティ関係にあるカードを、視覚的に識別可能とする。
- 2ファイル間でトレーサビリティ情報ファイルが存在する場合、隣り合うパネルに読み込まれた時点でトレース情報を表示可能とする。
- トレーサビリティのコネクタ表示有無は、トグルスイッチで切り替え可能とする。

### 6.4 カードパネル

#### 6.4.1 カードパネルツールバー
カードパネルの上部に以下のツールバーを表示する:
- すべて展開（▼アイコン）
- すべて折りたたみ（▶アイコン）
- 文字列フィルタ（テキストボックス）
- カード情報種別フィルタ（ドロップダウン表示し、カード情報種別毎にチェックボックスON/OFF）
- 選択中カードとトレーサビリティ関係のみ表示するフィルタ（🔽アイコン）
- コンパクト表示（☰アイコン）※トグルボタン

#### 6.4.2 カード一覧
- 縦／横スクロールでカードリスト情報を表示可能。
- カード表示はコンパクト表示と詳細表示の２通りの表示方法が可能。
- カード毎にコンパクト表示と詳細表示は選択可能。
- カードの親子関係を階層表示する（ツリー表示のように下の階層レベルは一段ネスト表示）。
- 任意の階層レベルを折畳／展開 表示可能。表示操作ができる。折畳/展開状態がわかる視覚表現をする。

**カード表示**
- カードの高さは、表示内容がすべて収まるように自動で調整する。
- カードの横幅は、画面サイズにより自動で調整する。
- 詳細表示は以下を表示する
	- カード情報種別
	- 情報内容
	- 最終更新時刻
- コンパクト表示の場合はカード情報種別、ステータス、情報内容の１行目で表示可能な文が見える。（よってカードの高さは１行分）
- トレーサビリティのコネクタ用接合点がカードの左右にあり。
- 接合点は〇/●のような表示。〇は接合点に対応するコネクタなし、●は接合点に対応するコネクタあり。

**カード情報の表示要素**
- カード情報種別アイコン: 見出し(📑)、段落(📝)、箇条書き(•)、図(🖼️)、表(📊)、試験(🧪)、QA(💬)
- ステータスバッジ: draft（下書き）、review（レビュー中）、approved（承認済み）、deprecated（廃止）

**トレーサビリティ表示**: 
- コネクタ事体を選択中の場合は、視覚的に強調表示する。
- アクティブパネルで選択中のカードと、レーサビリティ関係にあるカードとコネクタに対しては、視覚的に強調表示する。

**操作性**:
  - **複数選択**: 
    - **離散複数選択**: CTRLを押した状態の場合、同一階層の複数のカードを選択可能とする。カード位置は連続している必要はない。
    - **連続複数選択**: SHIFTを押した状態の場合、連続した同一階層の複数のカードを選択可能とする。

  - **移動**: ドラッグアンドドロップで表示位置（順序、階層レベル）を変更可能。移動先（=カード間の位置）をハイライトする。
    - **下位階層**: 自分より下位階層のカードについては、階層構造を維持してすべて移動する。
    - **複数選択**: **離散複数選択**または**連続複数選択**している状態で移動に対応する。

  - **編集**: カード情報種別`type`、カードの状態`status`、カード情報本文を編集可能とする。
    - **複数選択**: 複数選択状態の場合、カード情報種別`type`とカードの状態`status`を選択中のカードに対して同時に編集可能とする。


### 6.5 操作方法ダイアログ
操作方法を説明したダイアログを表示する。

### 6.6 バージョン情報ダイアログ
バージョン情報のダイアログを表示する。


## 7. データモデル仕様

### 7.1. カードファイル
以下の情報を持つ。
- `schemaVersion`（例: `1`）
- `header`
	- `id`: 一意な識別子（UUID v4 文字列）
	- `fileName`: ファイル名（例: `<inputfile>_<label>.json`）
	- `orgInputFilePath`: オリジナルの入力ファイルの絶対パス
	- `inputFilePath`: inputフォルダにコピーされた入力ファイルの絶対パス
	- `createdAt`: 初回の作成時刻（ISO 8601）
	- `updatedAt`: 最終更新時刻（ISO 8601）
	- `memo`: 任意記述
- `body[]`: カードオブジェクトの配列

### 7.2. カードオブジェクト
以下の情報を持つ。
- `id`: カードの一意な識別子（UUID v4 文字列）
- `type`: カード情報種別（`heading|paragraph|bullet|figure|table|test|qa|other`）
- `status`: カードの状態（`draft|review|approved|deprecated`）。既定は`draft`。
- `content`: 情報内容
  - `text`: テキスト情報(カード情報種別により、見出し内容、本文内容、図のテキスト表記、表のテキスト表記、試験手順と規格、質疑応答、議事録内容等として使用される)
  - `number`: 番号（カード情報種別により、図番号、表番号、試験番号などとして使用される。`図xx.xx`や`xxxxxxxx`等。）
- `updatedAt`: カード内容の最終更新時刻（ISO 8601）
- `parent_id`: 親カードID、なければ`null`
- `child_ids[]`: 子カード(自分より1階層下)IDリスト、なければ空配列
- `prev_id`: 兄弟(同一階層)の自分より順番が前のカードID、なければ`null`
- `next_id`: 兄弟(同一階層)の自分より順番が次のカードID、なければ`null`

### 7.3. トレーサビリティファイル
以下の情報を持つ。
- `schemaVersion`（例: `1`）
- `header`
	- `id`: 一意な識別子
	- `fileName`: ファイル名
	- `leftFilePath`: 左側カードファイルの絶対パス
	- `rightFilePath`: 右側カードファイルの絶対パス
	- `createdAt`: 初回の作成時刻（ISO 8601）
	- `updatedAt`: 最終更新時刻（ISO 8601）
	- `memo`: 任意記述
- `body[]`: トレーサビリティ情報

### 7.4. トレーサビリティ情報
以下の情報を持つ。
- `left_file`: 左側カードファイル名（例: `<inputfile1>_<label1>.json`）
- `right_file`: 右側カードファイル名（例: `<inputfile2>_<label2>.json`）
- `relations[]`: トレーサビリティ関係の配列
  - `id`: トレーサビリティ関係の一意な識別子（UUID v4 文字列）
  - `left_ids[]`: `left_file`のカードID配列
  - `right_ids[]`: `right_file`のカードID配列
  - `type`: 関係性の種別（`trace|refines|tests|duplicates|satisfy|relate|specialize`）。既定は`trace`。
  - `directed`: 方向性（`left_to_right|right_to_left|bidirectional`）。既定は`bidirectional`。
  - `memo`: 任意記述

## 8. 技術スタック
UIの操作性・拡張性とデータ保護の観点から、Electron/React/TypeScript によるデスクトップアプリとして実装する。

- **技術スタック**: Electron / React / TypeScript

## 9. 開発情報
### 9.1. 開発コマンド
- `npm install`: 依存関係のインストール
- `npm start`: 開発サーバー起動
- `npm run build`: プロダクションビルド
- `npm run electron`: Electronアプリ起動
- `npm test`: テスト実行

### 9.2. 改修時のルール
- 変更を行った場合は、ドキュメント（本ファイルなど）も併せてメンテナンスする。
- コミットメッセージは日本語で行う。
- 作業単位で作業報告を作成する。
- 作業報告は報告は、`report` フォルダ配下に格納する。

### 9.3. コミットのルール
- `spec/CommitMessage.md`を参照。

## 10. セキュリティ/プライバシー
- 既定でクラウドLLMへの送信は無効（`llm.allowCloud=false`）。
- 許可時は対象範囲・匿名化（`llm.redaction`）・監査ログを必須とする。

## 11. 配布/アップデート
- 配布対象: Windows/macOS/Linux（Electron Builder想定）
- コード署名の要否と証明書取り扱いは別紙運用設計に従う。
- 自動アップデート（autoUpdater）採用の有無は将来検討とし、本仕様のスコープ外。
