# 全体タスク分割・実行計画

## フェーズ0: プロジェクト体制・開発環境準備
- [x] P0-01 `journal/journal_YYYYMMDD.txt` を作成し、作業判断と根拠の記録運用を開始する。
- [x] P0-02 Node.js/Electron の採用バージョンを決定し `.nvmrc` と `package.json` に反映、全員に周知する。（Node.js 22.20.0 / Electron ^32.0.0 に統一済み）
- [x] P0-03 パッケージマネージャ運用方針を決定し、ロックファイル管理ルールを `CONTRIBUTING.md` に記載する。
- [x] P0-04 TDD 基盤（Jest + Testing Library + Playwright 等）を導入し、サンプルテストを緑にして実行確認する。※WSL2 では Chromium サンドボックスが動作しないため、CI/ローカルでは `--no-sandbox` 起動または対応可能なホストで実行する運用とする。
- [x] P0-05 ESLint/Prettier/TypeScript 設定を整備し、`npm run lint` と `npm run typecheck` が成功することを確認する。

## フェーズ1: アプリ骨格と大枠動作確認
- [x] P1-01 Electron + React + TypeScript テンプレートをセットアップし、`npm start` (`npm run dev`) でビルド・監視系（Viteウォッチ＋tscウォッチ＋Electron起動）が動作する構成を整える。※WSL2 環境では Electron が GUI 非対応のため `ipcMain` 等は無効となりウィンドウ表示は不可。GUI 環境では `npm run dev` で Skeleton 画面が表示される。
- [x] P1-02 メイン/レンダラ間の IPC スタブを実装し、`window.app.ping('renderer-ready')` が `ipcMain.handle('app:ping')` を経由して応答する構造を整備。GUI 対応ホストでは DevTools ログでハンドシェイク確認、WSL2 では Electron 実行不可のため後日検証。
- [x] P1-03 UI 設計書に基づきレイアウト骨格（メニューバー/ツールバー/サイドバー/カード領域/ログ/ステータスバー）をプレースホルダで構築し、画面分割リサイズが動作することを確認する。
- [x] P1-04 Zustand または Redux Toolkit によるグローバル状態ストアを構築し、ダミーカードデータの表示/更新が可能であることを確認する。
- [x] P1-05 Tailwind とテーマ切替基盤を導入し、ライト/ダークモードの切替が UI 全域に反映されることを確認する。

## フェーズ2: 共通機能の先行実装と動作確認
- [x] P2-01 アプリ設定管理 (`settings.json`) の読み書き API を実装し、設定変更が即時反映されることをエンドツーエンドで確認する。
- [x] P2-02 入出力ワークスペース構成（_input/_out/_logs）を自動生成し、サンプルファイルを入出力してログが残ることを確認する。
- [x] P2-03 ログ管理とローテーション機能を実装し、ログレベル切替とサイズ閾値の挙動をテストで保証する。
- [x] P2-04 共通ダイアログ/通知コンポーネントを実装し、エラー/警告/確認ダイアログが共通スタイルで動作することを確認する。
- [x] P2-05 ショートカットキーのマッピングを実装し、保存/分割/検索がキーボード操作で動作することを UI テストで確認する。
- [x] P2-05a 上下分割ボタン、左右分割ボタンによるカードパネルエリアの分割操作を実装し、分割がキーボード操作で動作することをUIテストで確認する。
- [x] P2-05b 上下分割、左右分割の境界をドラッグアンドドロップすることで、カードパネルエリアの分割領域を任意のサイズに調整できる機能を実装し、UIテストで確認する。
- [x] P2-06 カードパネルの分割管理ストアを設計し、左右/上下分割状態・分割ヒストリのデータモデルを実装する。
- [x] P2-07 カードパネル UI へ分割レイアウトコンテナを導入し、分割操作 (左右/上下)・分割解除を実装する。
- [x] P2-08 UI テスト用のサンプルカードファイルを作成の動作確認に利用できるよう整備する。選択中の分割パネルに読み込む機能を実装する。
- [x] P2-09a 分割パネルに読み込んだカードファイルは、タブで管理する。異なるファイルの場合は異なるタブで開く。タブごとに閉じることが可能。
- [x] P2-09b 各分割パネルはそれぞれ独立したカードファイルを保持できるようにする。同じカードファイルは複数分割パネルで開くことは禁止する。
- [x] P2-10a コネクタ描画レイヤ（SVG）の土台を実装し、左右ペア検出と単純なダミーコネクタ表示を確認する。
- [x] P2-10b カード要素の位置情報を収集するレイアウトストア/フックを実装し、スクロール・リサイズ追従を実現する。
- [x] P2-10c スタブトレースデータを用いて左右パネル間のカードIDを結合し、方向/種別に応じたスタイルを付与する。
- [x] P2-11a コネクタ描画用のスタブシナリオと統合テストを追加し、描画ロジックの回帰テスト基盤を整備する。
- [x] P2-11b 仮想化・パフォーマンス観測用のベンチマークスクリプトと監視指標を整備する。
- [x] P2-10d 左右アクティブタブのペアからトレーサビリティファイルを検出・読み込むワークフローを実装する。
- [x] P2-10d-1 同一カードから複数ペアが存在するケースに対応し、コネクタ描画ロジックを拡張する。
- [x] P2-10d-2 1対多(例：左1分割、右は上下に2分割)、左中右と水平方向に３分割におけるコネクタ表示にも対応していること。カードファイルがことなれば、複数のカードファイルで同じカードidを使用していても別物として識別できること。
- [x] P2-10d-3 カードの位置移動（スクロール・リサイズ）にコネクタ表示を追従させる(上下分割時の境界を上下に移動させた場合に追従していない)。処理量を効率化し不要な再描画を抑制する。
- [x] P2-11a ThemeSettingsに外観設定（ライト/ダークモード毎の色設定、境界幅）のスキーマを定義し、defaultSettingsに既定値を設定する。
- [x] P2-11b 設定をCSS変数に反映する機能を実装し、テーマ切替時に外観が変更されることを確認する。
- [x] P2-11c 設定変更が`settings.json`へ保存され、再起動後も反映されることをテストで確認する。
- [x] P2-12 カード構造の詳細表示/コンパクト表示を切り替える UI を実装し、モード間での状態保持と描画性能を確認する。
- [x] P2-13 カード階層表示と展開/折畳操作を実装し、階層状態がモード切替・再読込で保持されることを保証する。
- [x] P2-14 カード選択操作（単一/複数選択）とキーボード操作の挙動を実装し、選択状態がストアと同期することを確認する。
- [x] P2-15 選択したカードの移動操作（ドラッグ&ドロップ／ショートカット）を実装し、階層整合性とアンドゥ処理を整備する。
- [x] P2-16 カード編集 UI（ダブルクリックによるインライン編集）を実装し、編集確定/キャンセル時のストア更新とバリデーションを検証する。Undo/Redoスタックの実装する。
- [x] P2-17 カード追加/削除を実装する。カード追加は選択中最後尾カードの下で同階層へ。Undo/Redoスタックの実装する。
- [x] P2-18-1 UIカードのコピー／ペーストを実装する。複数選択状態でのコピー／ペーストを実装する。Undo/Redoスタックの実装する。
- [x] P2-18-2 UIカードのコピー／ペーストのドロップゾーンの視覚的フィードック、ドラッグプレビューを実装する。
- [x] P2-19 jsonファイルから読み取ったカード順序はランダムである可能性あるため、階層構造表示は親カードの下に子カードを表示するように実装する。
- [x] P2-20 設定ビュー UI を設計し、テーマ/入出力/ログ/ワークスペース項目を編集できるモーダルを実装する。
- [x] P2-21 UIカードの移動時のドラッグプレビューについて、カード間に移動するのか、子階層に移動するのか分かる視覚フィードバックにする。
- [x] P2-22a 編集後の階層構造表示を上書き保存 or 新規保存できるようにする。
- [x] P2-22b 移動したカードはファイル保存されるまで、視覚的にわかるようにする。

## フェーズ3: カード変換機能（大枠→詳細）
- [ ] P3-01 固定ルール変換エンジンのプロトタイプを作成し、仕様書サンプルからカードの順序/階層が生成されることをスナップショットテストで確認する。
- [ ] P3-02 LLM 変換用の API アダプタ抽象化を実装し、LLM 未接続時はスタブで安全に動作することを確認する。
- [ ] P3-03 CP932 を含む文字コード自動判別と UTF-8 変換処理を実装し、ユニットテストでエッジケースを網羅する。
- [ ] P3-04 10MB 超警告/200MB 超中断のハンドリングを実装し、モック入力でダイアログ挙動を確認する。
- [ ] P3-05 変換キャンセル/ロールバック処理と進捗表示を実装し、UI 上でキャンセル復帰が正しく機能することを確認する。

## フェーズ4: カード編集機能（操作体験検証→機能拡張）
- [x] P4-01 カードパネルのタブ領域で「＋」押下により、新規カードファイルを作成可能とする。保存押すまではカードファイルは作成せず、保存時に保存名を確認する。

## フェーズ5: トレーサビリティ機能
- [x] P5-01 カード間リンクデータモデルを策定し、トレース JSON の読み書きを確認する。
- [x] P5-02 トレーサビリティのコネクタ作成／削除を実装する。
- [x] P5-03 コネクタの表示フィルタを実装する。
- [ ] P5-04 トレーサ操作ログと監査記録を実装し、操作ごとにログが残ることを確認する。

## フェーズ6: 検索・フィルタ・生産性機能
- [ ] P6-01 全文/正規表現検索モジュールを実装し、範囲指定（ファイル内/全タブ/ディレクトリ）のテストを整備する。
- [ ] P6-02 表示フィルタ（カード種別/トレーサ条件）を実行時に切替できるよう実装し、階層補完表示を確認する。
- [ ] P6-03 置換機能と差分プレビューを実装し、キャンセル/適用が Undo と連携することを確認する。
- [ ] P6-04 ログエリアのライブ更新とフィルタリング（レベル/キーワード）を実装し、性能要件を満たすことを確認する。
- [ ] P6-05 ショートカットとコンテキストメニューの操作一覧をアプリ内ヘルプとして表示できるようにする。

## フェーズ7: 非機能要件・品質保証
- [ ] P7-01 大規模データ（10,000 カード）でのパフォーマンス計測スクリプトを作成し、要件値との比較結果を報告する。
- [ ] P7-02 アクセシビリティ検証（スクリーンリーダー/キーボードナビ）を実施し、改善事項をチケット化する。
- [ ] P7-03 エラーハンドリングと復旧シナリオ（設定破損/入出力失敗）のテストケースを整備し、自動テストに組み込む。
- [ ] P7-04 セキュリティ設定（クラウド LLM 送信無効が既定）を検証し、監査ログ要件を満たすことを確認する。
- [ ] P7-05 自動アップデート除外を明示する設定とユーザ通知文面を整備し、関連ドキュメントに反映する。
- [ ] P7-06 Playwright E2E をサンドボックス有効のサポート環境（例: Linux VM）で定期検証し、WSL2 開発環境向けの実行ガイドラインを整備する。
- [ ] P7-07 トレーサビリティのコネクタ本数が増えた場合のパフォーマンス検証を実施し、仮想化・非表示最適化の必要性を評価する。

## フェーズ8: 配布・運用準備
- [ ] P8-01 Electron Builder 設定を追加し、Windows/macOS/Linux 各ターゲットのビルドを生成して動作確認する。
- [ ] P8-02 コード署名の運用手順を別紙参照で整理し、必要な差分をドキュメントに追記する。
- [ ] P8-03 リリースパッケージの整合性検証スクリプト（ハッシュ生成）を作成し、CI に組み込む。
- [ ] P8-04 インストーラ/ポータブル版の配布手順を操作ガイドに追記する。
- [ ] P8-05 バージョニングとリリースノートテンプレートを整備し、初回リリースまでの TODO を列挙する。

## フェーズ9: ドキュメント・コミュニケーション
- [ ] P9-01 `doc/software_requirement.md` と `doc/user_interface_design.md` の差分反映プロセスを定義し、実装変更ごとにレビューするワークフローを確立する。
- [ ] P9-02 `doc/operation_design.md` を最新 UI に合わせてキャプチャ付きで更新する。
- [ ] P9-03 開発者向けセットアップガイド（`README.md`）を整備し、初回環境構築と TDD 方針を記載する。
- [ ] P9-04 ユーザサポート向け FAQ ドラフトを作成し、主要問い合わせシナリオを整理する。
- [ ] P9-05 コミットメッセージとブランチ運用ルールの最終版を `spec/commit_message.md` に反映する。
