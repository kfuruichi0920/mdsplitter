@tailwind base;
@tailwind components;
@tailwind utilities;

/**
 * テーマ設定から動的に注入されるCSS変数
 * - App.tsx の applyThemeColors() / applySplitterWidth() により設定される
 * - カスタムコンポーネントで var(--theme-*) として参照可能
 *
 * 利用可能な変数:
 *   --theme-background
 *   --theme-foreground
 *   --theme-border
 *   --theme-primary
 *   --theme-secondary
 *   --theme-card-background
 *   --theme-card-border
 *   --theme-connector-active
 *   --theme-connector-inactive
 *   --theme-splitter-width
 */

@layer base {
  html {
    @apply h-full;
  }

  body {
    @apply h-full overflow-hidden bg-theme-background text-theme-foreground transition-colors duration-300 ease-out;
    font-size: var(--theme-font-size, 14px);
    font-family: var(--theme-font-family, 'Inter, system-ui, -apple-system, "Segoe UI", sans-serif');
  }

  #root {
    @apply h-full;
  }

  button,
  input {
    @apply font-sans;
  }

  :root {
    --matrix-row-header-width: 220px;
    --matrix-row-count-width: 72px;
    --matrix-header-row-height: 52px;
  }
}

@layer components {
  .app-shell {
    @apply grid h-screen min-h-0 grid-rows-[28px_36px_minmax(0,1fr)_22px] bg-theme-background text-theme-foreground transition-colors duration-300 ease-out;
  }

  .app-shell[data-compact='true'] * {
    letter-spacing: -0.01em;
  }

  .menu-bar {
    @apply flex items-center gap-2 border-b border-theme-border bg-theme-background px-3 text-xs font-medium;
  }

  .menu-bar__items {
    @apply flex gap-2;
  }

  .menu-bar__item {
    @apply rounded-md px-2.5 py-1 text-xs font-medium text-theme-foreground transition-colors hover:bg-theme-primary/10 hover:text-theme-primary focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-theme-primary;
  }

  .top-toolbar {
    @apply flex items-center gap-3 border-b border-theme-border bg-theme-background px-3 py-1 text-xs;
  }

  .toolbar-group {
    @apply flex items-center gap-1.5 border-r border-theme-border pr-3;
  }

  .toolbar-group--trace {
    @apply relative;
  }

  .toolbar-group:last-of-type {
    @apply border-r-0 pr-0;
  }

  .toolbar-group--right {
    @apply gap-2;
  }

  .toolbar-spacer {
    @apply flex-1 border-b border-transparent;
  }

  .toolbar-button {
    @apply inline-flex items-center gap-1.5 rounded-md bg-theme-primary/10 px-2.5 py-1 text-xs font-medium text-theme-primary transition-colors hover:bg-theme-primary/20 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-theme-primary;
  }

  .toolbar-button--active {
    @apply bg-theme-primary text-theme-background;
  }

  .toolbar-button:disabled {
    @apply cursor-not-allowed opacity-60 hover:bg-theme-primary/10;
  }

  .toolbar-select {
    @apply inline-flex items-center rounded-md border border-theme-border bg-theme-card px-2 py-0.5 text-xs font-medium text-theme-foreground;
  }

  .toolbar-select select {
    @apply bg-transparent text-xs font-medium outline-none dark:bg-transparent;
  }

  .trace-filter-popover {
    @apply absolute right-0 top-10 z-40 w-48 rounded-md border border-theme-border bg-theme-card p-3 shadow-lg;
  }

  .trace-filter-popover__item {
    @apply flex items-center gap-2 text-xs text-theme-foreground;
  }

  .trace-filter-popover__item + .trace-filter-popover__item {
    @apply mt-1;
  }

  .trace-filter-popover__actions {
    @apply mt-2 flex justify-end gap-2;
  }

  .trace-filter-popover__actions button {
    @apply rounded-md bg-blue-100 px-2 py-0.5 text-xs font-medium text-blue-700 hover:bg-blue-200 dark:bg-slate-700 dark:text-blue-200;
  }

  .workspace {
    @apply grid h-full min-h-0 overflow-hidden bg-theme-background;
  }

  .workspace__content {
    @apply grid min-h-0 h-full overflow-hidden;
  }

  .sidebar {
    @apply flex min-w-0 flex-col gap-3 overflow-hidden border-r border-theme-border bg-theme-card px-3 py-3 shadow-inner;
  }

  .sidebar__section {
    @apply flex flex-col gap-1.5;
  }

  .sidebar__section--search {
    @apply flex flex-col gap-1.5;
  }

  .sidebar__section-toggle {
    @apply flex items-center gap-2 rounded-md px-2 py-1 text-xs font-semibold uppercase tracking-wide text-theme-secondary transition-colors hover:bg-theme-primary/10 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-theme-primary;
  }

  .sidebar__toggle-icon {
    @apply text-theme-secondary/70;
  }

  .sidebar__header {
    @apply text-xs font-semibold uppercase tracking-wide text-current;
  }

  .sidebar__content {
    @apply mt-2 flex flex-col gap-1.5;
  }

  .sidebar__content--search {
    @apply border-t border-slate-200 pt-2 dark:border-slate-700;
  }

  .sidebar__content--collapsed {
    @apply hidden;
  }

  .sidebar__tree,
  .sidebar__tree ul {
    @apply m-0 list-none pl-3;
    white-space: nowrap;
    overflow-x: auto;
  }

  .sidebar__tree > li {
    @apply mb-0.5;
  }

  .sidebar__tree li {
    @apply cursor-pointer rounded-md px-2 py-1 text-xs text-theme-secondary transition-colors hover:bg-theme-primary/10 hover:text-theme-primary;
    white-space: nowrap;
  }

  .sidebar__tree-file {
    @apply cursor-pointer rounded-md px-2 py-1 text-xs text-theme-secondary transition-colors hover:bg-theme-primary/10 hover:text-theme-primary focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-theme-primary;
  }

  .sidebar__tree-empty {
    @apply px-2 py-1 text-xs italic text-theme-secondary/70;
  }

  .sidebar__label {
    @apply text-[0.65rem] font-medium uppercase tracking-wide text-theme-secondary/70;
  }

  .sidebar__search {
    @apply rounded-md border border-theme-border bg-theme-background px-2.5 py-1.5 text-xs text-theme-foreground shadow-sm focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-theme-primary;
  }

  .sidebar__search-form {
    @apply flex flex-col gap-2;
  }

  .sidebar__search-options {
    @apply flex flex-wrap items-center gap-2;
  }

  .sidebar__search-field {
    @apply flex flex-col gap-1 text-[0.65rem] font-semibold uppercase tracking-wide text-theme-secondary;
  }

  .sidebar__search-field-label {
    @apply text-[0.6rem];
  }

  .sidebar__search-select {
    @apply rounded-md border border-theme-border bg-theme-background px-2 py-1 text-xs text-theme-foreground focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-theme-primary;
  }

  .sidebar__search-field--checkbox {
    @apply flex flex-row items-center gap-1 text-[0.7rem] font-semibold uppercase tracking-wide text-theme-secondary;
  }

  .sidebar__search-field--checkbox input {
    @apply h-4 w-4 rounded border-theme-border text-theme-primary focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-theme-primary;
  }

  .sidebar__search-actions {
    @apply flex items-center gap-2;
  }

  .sidebar__search-button {
    @apply flex-1 rounded-md bg-theme-primary px-2.5 py-1 text-xs font-semibold text-theme-background transition-colors hover:bg-theme-primary/90 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-theme-primary disabled:cursor-not-allowed disabled:opacity-60;
  }

  .sidebar__search-button--ghost {
    @apply border border-theme-border bg-theme-card text-theme-secondary hover:border-theme-primary/50 hover:text-theme-primary;
  }

  .sidebar__search-status {
    @apply text-[0.65rem] text-theme-secondary;
  }

  .sidebar__search-status--error {
    @apply text-rose-500 dark:text-rose-400;
  }

  .search-results {
    @apply mt-2 flex max-h-64 flex-col gap-2 overflow-y-auto pr-1;
  }

  .search-results__item {
    @apply w-full rounded-lg border border-theme-card-border bg-theme-card px-3 py-2 text-left text-xs shadow-sm transition-colors hover:border-theme-primary/50 hover:shadow-md focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-theme-primary;
  }

  .search-results__meta {
    @apply flex items-center gap-2 text-[0.6rem] text-theme-secondary;
  }

  .search-results__scope {
    @apply rounded-full bg-theme-secondary/10 px-2 py-0.5 text-[0.6rem] font-semibold uppercase tracking-wide text-theme-secondary;
  }

  .search-results__file {
    @apply flex-1 truncate;
  }

  .search-results__count {
    @apply rounded-full bg-theme-primary/10 px-2 py-0.5 text-[0.6rem] font-semibold text-theme-primary;
  }

  .search-results__title {
    @apply mt-1 text-sm font-semibold text-theme-foreground;
  }

  .search-results__snippet {
    @apply mt-0.5 whitespace-pre-wrap text-[0.65rem] text-theme-secondary;
  }

  .workspace__separator {
    @apply relative bg-theme-border transition-colors;
  }

  .workspace__separator::after {
    content: '';
    @apply absolute inset-0 bg-theme-primary/30 opacity-0 transition-opacity;
  }

  [data-dragging='true'] .workspace__separator::after,
  .workspace__separator:hover::after,
  .workspace__separator:focus-visible::after {
    @apply opacity-100;
  }

  .workspace__separator--vertical {
    @apply w-2 cursor-col-resize;
  }

  .workspace__separator--horizontal {
    @apply h-1.5 cursor-row-resize;
  }

  .panels {
    @apply flex h-full min-h-0 flex-col overflow-hidden bg-transparent;
  }

  .panels__body {
    @apply flex flex-1 min-h-0 overflow-hidden;
  }

  .split-grid {
    @apply grid h-full gap-3 overflow-auto p-3;
    grid-template-columns: minmax(0, 1fr);
    grid-template-rows: minmax(0, 1fr);
  }

  .split-grid--single {
    grid-template-columns: minmax(0, 1fr);
    grid-template-rows: minmax(0, 1fr);
  }

  .split-grid--vertical {
    grid-template-columns: repeat(2, minmax(0, 1fr));
    grid-template-rows: minmax(0, 1fr);
  }

  .split-grid--horizontal {
    grid-template-columns: minmax(0, 1fr);
    grid-template-rows: repeat(2, minmax(0, 1fr));
  }

  .split-node {
    @apply flex flex-1 h-full min-h-0 flex-col overflow-hidden rounded-lg border border-theme-border bg-theme-card shadow-md;
  }

  .split-node--active {
    @apply border-theme-primary shadow-lg ring-2 ring-theme-primary/40;
  }

  .split-node--semi-active {
    @apply border-amber-300 ring-1 ring-amber-200/60 dark:border-amber-400 dark:ring-amber-400/30;
  }

  .tab-bar {
    @apply flex flex-shrink-0 items-center gap-1.5 overflow-x-auto border-b border-theme-border bg-theme-background px-2 py-1.5 text-xs;
  }

  .tab-bar__tab-container {
    @apply flex items-center gap-1;
  }

  .tab-bar__tab {
    @apply rounded-md px-2.5 py-1 text-xs font-medium text-theme-secondary transition-colors hover:bg-theme-primary/10 hover:text-theme-primary;
  }

  .tab-bar__tab--active {
    @apply bg-theme-primary text-theme-background shadow-sm;
  }

  .tab-bar__tab--add {
    @apply font-semibold text-theme-secondary transition-colors hover:bg-theme-primary/10 hover:text-theme-primary focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-theme-primary;
  }

  .tab-bar__tab-title {
    @apply max-w-[10rem] truncate;
  }

  .tab-bar__tab-dirty {
    @apply ml-1 text-amber-500 dark:text-amber-300;
  }

  .tab-bar__tab-close {
    @apply rounded-md px-1.5 py-1 text-xs text-theme-secondary transition-colors hover:bg-rose-100 hover:text-rose-600 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-1 focus-visible:outline-rose-500 dark:hover:bg-rose-500/20 dark:hover:text-rose-200;
  }

  .tab-bar__spacer {
    @apply flex-1;
  }

  .tab-bar__empty {
    @apply px-2 text-theme-secondary;
  }

  .tab-bar__close {
    @apply rounded-md px-2 py-1 text-xs font-medium text-theme-secondary transition-colors hover:bg-rose-100 hover:text-rose-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-rose-500 dark:hover:bg-rose-500/20 dark:hover:text-rose-300;
  }

  .panel-header {
    @apply flex items-center justify-between border-b border-theme-border bg-theme-card px-3 py-2 text-xs font-medium;
  }

  .panel-toolbar {
    @apply flex flex-shrink-0 flex-wrap items-center gap-2 border-b border-theme-border bg-theme-card px-3 py-1.5 text-xs;
  }

  .panel-toolbar__group {
    @apply flex items-center gap-1.5;
  }

  .panel-toolbar__separator {
    @apply h-5 w-px bg-theme-border;
  }

  .panel-toolbar__button {
    @apply rounded-md bg-theme-background px-2.5 py-1 text-xs font-medium text-theme-foreground transition-colors hover:bg-theme-primary/10 hover:text-theme-primary focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-theme-primary;
  }

  .panel-toolbar__button--active {
    @apply bg-theme-primary text-theme-background hover:bg-theme-primary/90;
  }

  .panel-toolbar__input {
    @apply rounded-md border border-theme-border bg-theme-card px-2.5 py-1 text-xs text-theme-foreground shadow-sm focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-theme-primary;
  }

  .panel-toolbar__input--active {
    @apply border-theme-primary/50 bg-theme-primary/5;
  }

  .panel-toolbar__popover-anchor {
    @apply relative inline-flex;
  }

  .panel-filter-popover {
    @apply absolute right-0 top-full z-30 mt-2 w-48 rounded-lg border border-theme-border bg-theme-card p-2 text-xs shadow-2xl;
  }

  .panel-filter-popover__list {
    @apply flex max-h-48 flex-col gap-1 overflow-auto;
  }

  .panel-filter-popover__item {
    @apply flex items-center gap-2 rounded-md px-2 py-1 text-theme-secondary transition-colors hover:bg-theme-primary/10 hover:text-theme-primary;
  }

  .panel-filter-popover__icon {
    @apply text-base;
  }

  .panel-filter-popover__actions {
    @apply mt-2 flex gap-2;
  }

  .panel-filter-popover__actions button {
    @apply flex-1 rounded-md border border-theme-border bg-theme-card px-2 py-1 font-semibold text-[0.65rem] text-theme-secondary transition-colors hover:border-theme-primary/50 hover:text-theme-primary;
  }

  .panel-toolbar__select-wrapper {
    @apply relative;
  }

  .panel-toolbar__select {
    @apply rounded-md border border-theme-border bg-theme-card px-2 py-1 text-xs text-theme-foreground focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-theme-primary;
  }

  .panel-toolbar__spacer {
    @apply flex-1;
  }

  .panel-toolbar__meta {
    @apply text-[0.65rem] text-theme-secondary;
  }

  .panel-cards {
    @apply flex-1 min-h-0 flex flex-col gap-2.5 overflow-y-auto overflow-x-hidden bg-theme-background p-3;
  }

  .app-shell[data-compact='true'] .panel-cards {
    @apply gap-1.5 p-2;
  }

  .panel-cards__empty {
    @apply rounded-md border border-dashed border-theme-border px-3 py-6 text-center text-xs text-theme-secondary;
  }

  .card-list-item {
    @apply flex flex-col gap-1;
  }

  .card__drop-indicator {
    @apply relative z-20 h-1 rounded-full bg-blue-300/80 transition-all duration-150 ease-out dark:bg-blue-500/70;
  }

  .card__drop-indicator--before,
  .card__drop-indicator--after {
    @apply mx-3;
  }

  .card__drop-indicator-label {
    @apply pointer-events-none absolute -top-7 left-1/2 -translate-x-1/2 rounded-full bg-blue-600 px-3 py-1 text-[0.7rem] font-semibold uppercase tracking-wide text-white shadow-xl ring-2 ring-white/70 dark:bg-blue-400 dark:text-slate-900;
  }

  .card--dragging {
    @apply opacity-60;
  }

  .card--drop-child {
    @apply ring-2 ring-blue-400/60 dark:ring-blue-500/70;
  }

  .card__drop-child-overlay {
    @apply pointer-events-none absolute inset-2 z-20 flex items-center justify-center rounded-lg border-2 border-dashed border-blue-400/80 bg-blue-600/20 text-sm font-semibold text-blue-800 drop-shadow-lg dark:border-blue-300/60 dark:bg-blue-300/20 dark:text-blue-100;
  }

  .card__drop-child-label {
    @apply text-[0.75rem] tracking-wide;
  }

  .card--highlighted {
    animation: card-highlight 1.2s ease-out;
  }

  @keyframes card-highlight {
    0% {
      box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.45);
    }
    100% {
      box-shadow: 0 0 0 14px rgba(59, 130, 246, 0);
    }
  }

  .panel-context-menu {
    @apply fixed z-50 min-w-[180px] rounded-md border border-slate-200 bg-white py-1 shadow-xl dark:border-slate-700 dark:bg-slate-900;
  }

  .panel-context-menu__item {
    @apply flex w-full items-center gap-2 px-3 py-1.5 text-left text-xs text-slate-700 transition-colors hover:bg-blue-50 hover:text-blue-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-500 dark:text-slate-100 dark:hover:bg-slate-800;
  }

  .panel-context-menu__item--danger {
    @apply text-red-600 hover:bg-red-50 hover:text-red-700 dark:text-red-300 dark:hover:bg-red-900/30;
  }

  .panel-context-menu__item:disabled,
  .panel-context-menu__item[aria-disabled='true'] {
    @apply cursor-not-allowed opacity-40 hover:bg-transparent hover:text-inherit;
  }

  .panel-context-menu__section {
    @apply flex flex-col gap-1;
  }

  .panel-context-menu__divider {
    @apply my-1 border-t border-slate-200 dark:border-slate-700;
  }

  .panel-context-menu__section-label {
    @apply px-3 pb-1 text-[10px] font-semibold uppercase tracking-wide text-slate-400 dark:text-slate-500;
  }

  .panel-context-menu__icon {
    @apply text-base leading-none;
  }

  .panel-context-menu__label {
    @apply flex-1 text-left;
  }

  .panel-context-menu__shortcut {
    @apply text-[10px] font-mono text-slate-400 dark:text-slate-500;
  }

  .settings-modal__backdrop {
    @apply fixed inset-0 z-50 bg-slate-900/70 backdrop-blur-sm;
  }

  .settings-modal {
    @apply absolute left-1/2 top-1/2 flex w-[640px] max-w-[calc(100%-2rem)] max-h-[70vh] -translate-x-1/2 -translate-y-1/2 flex-col overflow-hidden rounded-2xl border border-theme-border bg-theme-card shadow-2xl;
  }

  .settings-modal__header {
    @apply flex items-start justify-between gap-4 border-b border-theme-border px-6 py-4;
  }

  .settings-modal__header h2 {
    @apply text-base font-semibold;
  }

  .settings-modal__subtitle {
    @apply text-xs text-theme-secondary;
  }

  .settings-close-button {
    @apply rounded-full border border-transparent p-1 text-theme-secondary transition hover:border-theme-border hover:text-theme-foreground;
  }

  .settings-modal__body {
    @apply flex flex-1 min-h-0 divide-x divide-theme-border;
  }

  .settings-modal__nav {
    @apply flex w-40 min-w-[140px] flex-col gap-1 bg-theme-background p-4 text-left text-sm;
  }

  .settings-nav__item {
    @apply flex items-center gap-2 rounded-md px-3 py-2 text-left text-theme-secondary transition hover:bg-theme-primary/10 hover:text-theme-primary;
  }

  .settings-nav__item--active {
    @apply bg-theme-primary text-theme-background hover:bg-theme-primary/90;
  }

  .settings-modal__content {
    @apply flex-1 overflow-auto p-6 text-sm;
  }

  .settings-modal__section {
    @apply flex flex-col gap-4;
  }

  .settings-field {
    @apply flex flex-col gap-1;
  }

  .settings-field--inline {
    @apply flex-row items-center justify-between gap-3;
  }

  .settings-field__label {
    @apply text-xs font-semibold uppercase tracking-wide text-theme-secondary;
  }

  .settings-field__note {
    @apply text-xs text-theme-secondary;
  }

  .settings-field__error {
    @apply text-xs text-rose-500;
  }

  .settings-radio-group {
    @apply flex gap-3;
  }

  .settings-radio {
    @apply flex items-center gap-2 rounded-full border border-theme-border px-3 py-1 text-xs transition hover:border-theme-primary;
  }

  .settings-radio input {
    @apply text-theme-primary;
  }

  .settings-checkbox {
    @apply flex items-center gap-2 text-sm;
  }

  .settings-modal__footer {
    @apply flex items-center justify-between gap-4 border-t border-theme-border px-6 py-4 text-xs;
  }

  .settings-modal__actions {
    @apply flex gap-2;
  }

  .settings-primary-button {
    @apply rounded-md bg-theme-primary px-4 py-2 text-sm font-semibold text-theme-background transition hover:bg-theme-primary/90 disabled:cursor-not-allowed disabled:opacity-50;
  }

  .settings-secondary-button {
    @apply rounded-md border border-theme-border px-4 py-2 text-sm font-medium text-theme-foreground hover:bg-theme-background disabled:cursor-not-allowed disabled:opacity-50;
  }

  .settings-modal__error {
    @apply text-xs text-rose-500;
  }

  .settings-loading {
    @apply text-sm text-theme-secondary;
  }

  .settings-recent-list {
    @apply max-h-28 overflow-auto text-xs text-theme-secondary;
  }

  .settings-recent-list li {
    @apply truncate;
  }

  .conversion-modal__backdrop {
    @apply fixed inset-0 z-50 bg-slate-900/70 backdrop-blur-sm;
  }

  .conversion-modal {
    @apply absolute left-1/2 top-1/2 flex w-[720px] max-w-[calc(100%-2rem)] max-h-[80vh] -translate-x-1/2 -translate-y-1/2 flex-col overflow-hidden rounded-2xl border border-theme-border bg-theme-card text-sm shadow-2xl;
  }

  .conversion-modal__header {
    @apply flex items-start justify-between gap-4 border-b border-theme-border px-6 py-4;
  }

  .conversion-modal__header h2 {
    @apply text-base font-semibold;
  }

  .conversion-modal__subtitle {
    @apply text-xs text-theme-secondary;
  }

  .conversion-modal__close {
    @apply rounded-full border border-transparent px-2 py-1 text-lg text-theme-secondary transition hover:border-theme-border hover:text-theme-foreground;
  }

  .conversion-modal__body {
    @apply flex flex-col gap-6 overflow-auto px-6 py-4;
  }

  .conversion-modal__section {
    @apply flex flex-col gap-3 rounded-2xl border border-theme-border bg-theme-background/70 p-4;
  }

  .conversion-modal__section-header {
    @apply flex items-center justify-between gap-4 text-sm font-semibold;
  }

  .conversion-modal__file dl {
    @apply grid grid-cols-2 gap-2 text-xs text-theme-secondary;
  }

  .conversion-modal__file dt {
    @apply font-semibold text-theme-secondary/70;
  }

  .conversion-modal__preview {
    @apply mt-3 max-h-40 overflow-auto rounded-lg border border-theme-border bg-theme-card p-3 text-xs font-mono leading-relaxed;
  }

  .conversion-modal__empty {
    @apply text-xs text-theme-secondary/70;
  }

  .conversion-modal__warning {
    @apply rounded-xl border border-amber-300 bg-amber-50 px-3 py-2 text-xs text-amber-700 dark:border-amber-500/60 dark:bg-amber-500/10 dark:text-amber-200;
  }

  .conversion-modal__checkbox {
    @apply mt-2 flex items-center gap-2 text-xs;
  }

  .conversion-modal__strategies {
    @apply flex flex-col gap-2;
  }

  .conversion-modal__radio {
    @apply flex cursor-pointer gap-3 rounded-xl border border-theme-border bg-theme-card p-3 text-left transition hover:border-theme-primary;
  }

  .conversion-modal__radio input {
    @apply mt-1 text-theme-primary;
  }

  .conversion-modal__error {
    @apply px-6 text-xs text-rose-500;
  }

  .conversion-modal__progress {
    @apply px-6 pb-3 text-xs text-theme-secondary;
  }

  .conversion-modal__progress-bar {
    @apply mb-1 h-2 w-full rounded-full bg-theme-background;
  }

  .conversion-modal__progress-bar > div {
    @apply h-full rounded-full bg-theme-primary transition-all;
  }

  .conversion-modal__footer {
    @apply flex items-center justify-end gap-3 border-t border-theme-border px-6 py-4;
  }

  .btn-primary {
    @apply rounded-md bg-blue-600 px-5 py-2 text-sm font-semibold text-white transition hover:bg-blue-500 disabled:cursor-not-allowed disabled:bg-slate-400;
  }

  .btn-secondary {
    @apply rounded-md border border-slate-300 px-5 py-2 text-sm font-medium text-slate-700 hover:bg-slate-100 disabled:cursor-not-allowed disabled:opacity-60 dark:border-slate-600 dark:text-slate-100 dark:hover:bg-slate-800;
  }

  .status-bar__section--progress {
    @apply flex-1 text-center text-xs text-slate-600 dark:text-slate-300;
  }

  .card {
    @apply relative flex cursor-pointer select-none flex-col gap-2 rounded-lg border border-transparent bg-theme-card p-3 shadow-sm transition-all hover:border-theme-primary/30 hover:shadow-md focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-theme-primary;
  }

  .card[data-tooltip]::after {
    content: attr(data-tooltip);
    @apply pointer-events-none absolute left-1/2 top-full z-50 mt-2 max-w-[28rem] rounded-md border border-theme-border bg-theme-card px-3 py-2 text-xs leading-snug text-theme-foreground shadow-lg opacity-0 transition-opacity duration-150 ease-out;
    transform: translateX(-50%);
    white-space: pre-wrap;
  }

  .card[data-tooltip]::before {
    content: '';
    @apply pointer-events-none absolute left-1/2 top-full z-40 mt-1 h-2 w-2 rotate-45 border border-theme-border bg-theme-card opacity-0 transition-opacity duration-150 ease-out;
    transform: translateX(-50%);
  }

  .card[data-tooltip]:hover::after,
  .card[data-tooltip]:focus-visible::after,
  .card[data-tooltip]:hover::before,
  .card[data-tooltip]:focus-visible::before {
    @apply opacity-100;
  }


  .card--selected-primary {
    @apply border-l-4 border-theme-primary bg-theme-primary/10 shadow-lg;
  }

  .card--selected-secondary {
    @apply border-l-4 border-amber-400 bg-amber-50/70 dark:border-amber-400 dark:bg-amber-500/10;
  }

  .card--selected-inactive {
    @apply border-l-4 border-theme-border bg-theme-card;
  }

  .card--dirty {
    @apply ring-1 ring-amber-400/70 ring-offset-1 ring-offset-amber-50 dark:ring-amber-300/60 dark:ring-offset-slate-900;
  }

  .card--compact {
    @apply flex-row items-center gap-2 py-1.5;
  }

  .app-shell[data-compact='true'] .card--compact {
    @apply gap-1 py-1;
  }

  .card--compact .card__header {
    @apply contents;
  }

  .card--compact .card__body,
  .card--compact .card__footer {
    @apply hidden;
  }

  .card__header {
    @apply flex items-center gap-2 text-xs font-semibold;
  }

  .app-shell[data-compact='true'] .card__header {
    @apply gap-1 text-[11px];
  }

  .card__connector-button {
    @apply relative inline-flex h-6 w-6 items-center justify-center rounded-full border border-theme-border text-xs text-theme-secondary transition-colors hover:border-theme-primary/50 hover:text-theme-primary focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-theme-primary;
  }

  .card__connector-button:disabled {
    @apply cursor-not-allowed opacity-50 hover:border-theme-border hover:text-theme-secondary;
  }

  .card__connector--active {
    @apply border-theme-connector-active text-theme-connector-active;
  }

  .card__connector--muted {
    @apply opacity-40;
  }

  .card__connector-count {
    @apply absolute -top-1 -right-1 min-w-[14px] rounded-full bg-theme-primary px-1 text-[0.55rem] font-bold leading-3 text-theme-background;
  }

  .card__markdown-button {
    @apply inline-flex h-6 min-w-[32px] items-center justify-center rounded-md border border-theme-border bg-theme-card px-1.5 text-[0.65rem] font-semibold uppercase tracking-wide text-theme-secondary transition-colors hover:border-theme-primary/50 hover:text-theme-primary focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-theme-primary;
  }

  .card__markdown-button--active {
    @apply border-theme-primary bg-theme-primary/10 text-theme-primary;
  }

  .card--trace-related {
    @apply ring-1 ring-offset-1 ring-theme-primary/50 ring-offset-theme-primary/10;
  }

  .card__icon {
    @apply text-sm;
  }

  .card__status {
    @apply rounded-full px-2.5 py-0.5 text-[0.65rem] font-semibold uppercase tracking-wide;
  }

  .card__status--approved {
    @apply bg-emerald-100 text-emerald-600 dark:bg-emerald-500/20 dark:text-emerald-300;
  }

  .card__status--draft {
    @apply bg-theme-secondary/20 text-theme-secondary;
  }

  .card__status--review {
    @apply bg-amber-100 text-amber-600 dark:bg-amber-500/20 dark:text-amber-200;
  }

  .card__status--deprecated {
    @apply bg-rose-100 text-rose-600 dark:bg-rose-500/20 dark:text-rose-200;
  }

  .card__title {
    @apply flex-1 text-sm font-semibold text-theme-foreground;
  }

  .card--editing {
    @apply cursor-text bg-theme-card text-theme-foreground;
  }

  .card__title-input {
    @apply flex-1 rounded-md border border-theme-border bg-theme-card px-2 py-1 text-sm font-semibold text-theme-foreground shadow-inner focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-theme-primary placeholder:text-theme-secondary/70;
  }

  .card__body-input {
    @apply mt-2 w-full rounded-md border border-theme-border bg-theme-card px-2 py-2 text-sm leading-relaxed text-theme-foreground shadow-inner focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-theme-primary placeholder:text-theme-secondary/70;
  }

  .card__markdown-hint {
    @apply mt-1 text-[0.65rem] text-theme-secondary/70;
  }

  .card__title--truncate {
    @apply overflow-hidden text-ellipsis whitespace-nowrap;
  }

  .card__body {
    @apply whitespace-pre-wrap text-xs leading-relaxed text-theme-secondary;
  }

  .card__body--markdown {
    @apply text-xs leading-relaxed text-theme-foreground;
  }

  .card__body--markdown p {
    @apply mb-2;
  }

  .card__body--markdown ul,
  .card__body--markdown ol {
    @apply mb-2 pl-5;
  }

  .card__body--markdown ul {
    @apply list-disc;
  }

  .card__body--markdown ol {
    @apply list-decimal;
  }

  .card__body--markdown code {
    @apply rounded bg-slate-200 px-1 py-0.5 font-mono text-[0.7rem] dark:bg-slate-700 dark:text-slate-100;
  }

  .card__body--markdown pre {
    @apply overflow-auto rounded-md bg-slate-900/80 px-3 py-2 text-[0.75rem] text-slate-100 dark:bg-slate-800;
  }

  .card__body--markdown a {
    @apply text-blue-600 underline dark:text-blue-300;
  }

  .card__body--markdown .markdown-table {
    @apply mb-2 w-full border-collapse overflow-hidden rounded-md border border-slate-300 text-xs dark:border-slate-600;
  }

  .card__body--markdown .markdown-table th {
    @apply border border-slate-300 bg-slate-100 px-2 py-1 font-semibold text-slate-700 dark:border-slate-600 dark:bg-slate-800 dark:text-slate-200;
  }

  .card__body--markdown .markdown-table td {
    @apply border border-slate-300 bg-white px-2 py-1 text-slate-700 dark:border-slate-600 dark:bg-slate-900 dark:text-slate-200;
  }

  .card__body--markdown .markdown-table tbody tr:hover {
    @apply bg-slate-50 dark:bg-slate-800/50;
  }

  .card__footer {
    @apply text-[0.65rem] text-theme-secondary/70;
  }

  .card__expand-button {
    @apply flex h-4 w-4 flex-shrink-0 items-center justify-center rounded text-xs text-theme-secondary transition-colors hover:bg-theme-secondary/20 hover:text-theme-foreground;
  }

  .card__expand-placeholder {
    @apply inline-block h-4 w-4 flex-shrink-0;
  }

  .panel-placeholder {
    @apply flex flex-1 items-center justify-center bg-theme-background px-3 py-6 text-xs text-theme-secondary;
  }

  .log-area {
    @apply flex flex-col border-t border-theme-border bg-theme-card shadow-inner;
  }

  .log-area__header {
    @apply flex flex-wrap items-start justify-between gap-2 border-b border-theme-border px-3 py-1.5 text-xs font-semibold;
  }

  .log-area__title {
    @apply flex items-baseline gap-2 text-xs font-semibold text-theme-secondary;
  }

  .log-area__counter {
    @apply rounded-full bg-theme-background px-2 py-0.5 text-[0.6rem] font-semibold text-theme-secondary;
  }

  .log-area__filters {
    @apply flex flex-wrap items-center gap-2;
  }

  .log-area__select {
    @apply rounded-md border border-theme-border bg-theme-card px-2 py-1 text-xs text-theme-secondary focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-theme-primary;
  }

  .log-area__filter-input {
    @apply rounded-md border border-theme-border bg-theme-card px-2 py-1 text-xs text-theme-foreground focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-theme-primary;
  }

  .log-area__clear {
    @apply rounded-md bg-rose-100 px-2.5 py-1 text-xs font-medium text-rose-600 transition-colors hover:bg-rose-200 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-rose-500 dark:bg-rose-500/20 dark:text-rose-200;
  }

  .log-area__copy {
    @apply rounded-md bg-blue-100 px-2.5 py-1 text-xs font-medium text-blue-600 transition-colors hover:bg-blue-200 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-500 dark:bg-blue-500/20 dark:text-blue-200;
  }

  .log-area__body {
    @apply flex-1 overflow-auto bg-theme-background px-3 py-2.5 font-mono text-[0.7rem] leading-relaxed text-theme-secondary select-text;
  }

  .status-bar {
    @apply flex items-center justify-between gap-3 border-t border-theme-border bg-theme-card px-3 text-[0.65rem] uppercase tracking-wide text-theme-secondary;
  }

  .status-bar__section {
    @apply flex items-center gap-4;
  }

  .status-bar__section--right {
    @apply justify-end;
  }

  .notification-center {
    @apply fixed right-4 top-16 z-50 flex w-80 flex-col gap-2;
  }

  .notification {
    @apply flex items-start gap-2 rounded-lg border px-3 py-2 text-xs shadow-lg backdrop-blur;
  }

  .help-overlay {
    @apply fixed inset-0 z-40 flex items-center justify-center;
  }

  .help-overlay__backdrop {
    @apply absolute inset-0 bg-slate-900/60 backdrop-blur-sm;
  }

  .help-overlay__panel {
    @apply relative z-10 w-full max-w-3xl max-h-[90vh] overflow-hidden rounded-2xl border border-slate-200 bg-white p-6 shadow-2xl dark:border-slate-800 dark:bg-slate-900;
  }

  .help-overlay__header {
    @apply mb-4 flex items-center justify-between text-base font-semibold text-slate-700 dark:text-slate-100;
  }

  .help-overlay__close {
    @apply rounded-md bg-slate-100 px-2 py-1 text-sm text-slate-600 transition-colors hover:bg-rose-100 hover:text-rose-600 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-rose-500 dark:bg-slate-800 dark:text-slate-300 dark:hover:bg-rose-500/20 dark:hover:text-rose-200;
  }

  .help-overlay__body {
    @apply grid max-h-[70vh] gap-4 overflow-y-auto text-sm text-slate-600 dark:text-slate-200 md:grid-cols-2;
  }

  .help-overlay__group h3 {
    @apply mb-2 text-xs font-semibold uppercase tracking-wide text-slate-500 dark:text-slate-400;
  }

  .help-overlay__list {
    @apply flex flex-col gap-2;
  }

  .help-overlay__item {
    @apply flex items-start gap-3 rounded-md border border-slate-200 bg-white/90 px-3 py-2 text-xs shadow-sm dark:border-slate-700 dark:bg-slate-800;
  }

  .help-overlay__keys {
    @apply min-w-[120px] font-semibold text-slate-800 dark:text-slate-100;
  }

  .help-overlay__description {
    @apply flex-1 text-slate-600 dark:text-slate-200;
  }

  .notification__message {
    @apply flex-1 leading-normal;
  }

  .notification__close {
    @apply rounded-full px-2 py-0.5 text-xs font-semibold transition-colors hover:bg-white/20 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-400;
  }

  /* 分割コンテナ関連スタイル */
  .split-container {
    @apply relative flex-1 h-full w-full min-h-0 min-w-0;
  }

  .split-container--horizontal {
    @apply flex flex-col min-h-0 min-w-0;
  }

  .split-container--vertical {
    @apply flex flex-row min-h-0 min-w-0;
  }

  .split-leaf {
    @apply flex-1 h-full w-full min-h-0 min-w-0 overflow-hidden;
  }

  .split-leaf__viewport {
    @apply flex flex-1 h-full w-full min-h-0 min-w-0 overflow-hidden;
  }

  .splitter {
    @apply relative bg-blue-200 transition-colors dark:bg-slate-700;
  }

  .splitter::after {
    content: '';
    @apply absolute inset-0 bg-blue-300 opacity-0 transition-opacity dark:bg-slate-600;
  }

  .splitter:hover::after,
  .splitter:active::after {
    @apply opacity-100;
  }

  .splitter--horizontal {
    @apply h-1 cursor-row-resize;
  }

  .splitter--vertical {
    @apply w-1 cursor-col-resize;
  }

  .trace-connector-layer {
    @apply absolute inset-0 z-10 pointer-events-none;
  }

  .trace-connector-layer__svg {
    @apply h-full w-full;
    pointer-events: none;
  }

  .trace-connector-path {
    fill: none;
    stroke: var(--trace-color-trace, rgba(96, 165, 250, 0.7));
    stroke-width: 2;
    transition: stroke 0.2s ease;
    cursor: pointer;
    pointer-events: visibleStroke;
  }

  .trace-connector-path--placeholder {
    stroke-dasharray: 8 6;
  }

  .trace-connector-path--trace {
    stroke: var(--trace-color-trace, rgba(96, 165, 250, 0.9));
  }

  .trace-connector-path--refines {
    stroke: var(--trace-color-refines, rgba(16, 185, 129, 0.85));
  }

  .trace-connector-path--tests {
    stroke: var(--trace-color-tests, rgba(249, 115, 22, 0.85));
    stroke-dasharray: 6 4;
  }

  .trace-connector-path--duplicates {
    stroke: var(--trace-color-duplicates, rgba(244, 63, 94, 0.8));
    stroke-width: 2.5;
  }

  .trace-connector-path--satisfy {
    stroke: var(--trace-color-satisfy, rgba(99, 102, 241, 0.9));
  }

  .trace-connector-path--relate {
    stroke: var(--trace-color-relate, rgba(20, 184, 166, 0.85));
  }

  .trace-connector-path--specialize {
    stroke: var(--trace-color-specialize, rgba(168, 85, 247, 0.85));
  }

  .trace-connector-path--highlight {
    stroke-width: 3.2;
    stroke: var(--trace-highlight-color, rgba(147, 197, 253, 0.95));
    filter: drop-shadow(0 0 4px var(--trace-highlight-color, rgba(147, 197, 253, 0.4)));
  }

  .trace-connector-path--hover {
    stroke-width: 3;
    filter: drop-shadow(0 0 6px rgba(147, 197, 253, 0.7));
  }

  .trace-connector-path--selected {
    stroke-width: 3.6;
    stroke: var(--trace-selected-color, #34d399);
    filter: drop-shadow(0 0 6px rgba(52, 211, 153, 0.6));
  }

  .trace-connector-path--dir-forward {
    marker-end: url(#trace-connector-arrow);
  }

  .trace-connector-path--dir-backward {
    marker-start: url(#trace-connector-arrow);
  }

  .trace-connector-path--dir-bidirectional {
    marker-start: url(#trace-connector-arrow);
    marker-end: url(#trace-connector-arrow);
  }

  .trace-connector-tooltip {
    @apply absolute max-w-xs rounded bg-slate-900/90 px-3 py-2 text-xs text-white shadow-lg;
    pointer-events: none;
  }

  .trace-connector-tooltip__label {
    @apply font-semibold;
  }

  .trace-connector-tooltip__meta {
    @apply text-slate-300;
  }

  .trace-connector-tooltip__memo {
    @apply mt-1 whitespace-pre-wrap;
  }

  .trace-connector-tooltip__memo--empty {
    @apply italic text-slate-400;
  }

  /* ConversionModal カードID設定フィールド */
  .conversion-modal__card-id-settings {
    @apply flex flex-col gap-3;
  }

  .conversion-modal__field-row {
    @apply grid grid-cols-3 gap-3;
  }

  .conversion-modal__field {
    @apply flex flex-col gap-1;
  }

  .conversion-modal__field label {
    @apply text-xs font-semibold text-slate-600 dark:text-slate-300;
  }

  .conversion-modal__field input[type="text"],
  .conversion-modal__field input[type="number"] {
    @apply rounded-md border border-slate-300 bg-white px-3 py-2 text-sm text-slate-800 shadow-sm focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-500 dark:border-slate-600 dark:bg-slate-800 dark:text-slate-100 dark:placeholder:text-slate-400;
  }

  .conversion-modal__field-help {
    @apply text-xs text-slate-500 dark:text-slate-400;
  }

  .conversion-modal__radio-group {
    @apply flex flex-wrap gap-3;
  }

  .conversion-modal__radio-inline {
    @apply flex items-center gap-2 text-sm text-slate-700 dark:text-slate-200;
  }

  .conversion-modal__radio-inline input[type="radio"] {
    @apply text-blue-500;
  }

  .conversion-modal__preview-box {
    @apply mt-2 rounded-md border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-700 dark:border-slate-700 dark:bg-slate-800 dark:text-slate-200;
  }

  /* モーダルダイアログ（一括編集用） */
  .modal-overlay {
    @apply fixed inset-0 z-50 flex items-center justify-center bg-slate-900/70 backdrop-blur-sm;
  }

  .modal-content {
    @apply flex w-[480px] max-w-[calc(100%-2rem)] flex-col gap-4 rounded-2xl border border-slate-200 bg-white p-6 shadow-2xl dark:border-slate-700 dark:bg-slate-900;
  }

  .modal-title {
    @apply text-lg font-semibold text-slate-800 dark:text-slate-100;
  }

  .modal-description {
    @apply text-sm text-slate-600 dark:text-slate-300;
  }

  .modal-form {
    @apply flex flex-col gap-3;
  }

  .modal-label {
    @apply flex flex-col gap-1 text-xs font-semibold text-slate-600 dark:text-slate-300;
  }

  .modal-input {
    @apply rounded-md border border-slate-300 bg-white px-3 py-2 text-sm text-slate-800 shadow-sm focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-500 dark:border-slate-600 dark:bg-slate-800 dark:text-slate-100 dark:placeholder:text-slate-400;
  }

  .modal-actions {
    @apply flex justify-end gap-2;
  }

  .modal-button {
    @apply rounded-md px-4 py-2 text-sm font-semibold transition-colors;
  }

  .modal-button--primary {
    @apply bg-blue-600 text-white hover:bg-blue-500 dark:bg-blue-500 dark:hover:bg-blue-400;
  }

  .modal-button--secondary {
    @apply border border-slate-300 bg-white text-slate-700 hover:bg-slate-100 dark:border-slate-600 dark:bg-slate-800 dark:text-slate-100 dark:hover:bg-slate-700;
  }

  .card-merge-dialog {
    @apply flex w-[620px] max-w-[calc(100%-2rem)] max-h-[80vh] flex-col gap-5 overflow-hidden rounded-2xl border border-slate-200 bg-white p-6 shadow-2xl dark:border-slate-700 dark:bg-slate-900;
  }

  .card-merge-dialog__header {
    @apply flex items-start justify-between gap-4;
  }

  .card-merge-dialog__eyebrow {
    @apply text-xs uppercase tracking-wide text-slate-400 dark:text-slate-500;
  }

  .card-merge-dialog__title {
    @apply text-lg font-semibold text-slate-900 dark:text-slate-100;
  }

  .card-merge-dialog__close {
    @apply rounded-full border border-transparent bg-slate-100 px-2 py-1 text-xs font-bold text-slate-500 transition hover:bg-slate-200 hover:text-slate-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-500 dark:bg-slate-800 dark:text-slate-300;
  }

  .card-merge-dialog__section {
    @apply flex flex-col gap-3 rounded-xl border border-slate-100 bg-slate-50 p-4 dark:border-slate-800 dark:bg-slate-800;
  }

  .card-merge-dialog__body {
    @apply flex flex-col gap-4 overflow-y-auto pr-1;
  }

  .card-merge-dialog__section h3 {
    @apply text-sm font-semibold text-slate-700 dark:text-slate-200;
  }

  .card-merge-dialog__list {
    @apply list-inside list-disc space-y-1 text-sm text-slate-600 dark:text-slate-300;
  }

  .card-merge-dialog__badge {
    @apply mr-2 rounded-full bg-slate-200 px-2 py-0.5 text-xs font-mono text-slate-700 dark:bg-slate-700 dark:text-slate-200;
  }

  .card-merge-dialog__field {
    @apply flex flex-col gap-1 text-sm text-slate-700 dark:text-slate-200;
  }

  .card-merge-dialog__field input,
  .card-merge-dialog__field select {
    @apply rounded-md border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-500 dark:border-slate-600 dark:bg-slate-900 dark:text-slate-100;
  }

  .card-merge-dialog__textarea {
    @apply min-h-[160px] rounded-md border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-500 dark:border-slate-600 dark:bg-slate-900 dark:text-slate-100;
  }

  .card-merge-dialog__checkbox {
    @apply flex items-center gap-2 text-sm text-slate-700 dark:text-slate-200;
  }

  .card-merge-dialog__hint {
    @apply text-xs text-slate-500 dark:text-slate-400;
  }

  .card-merge-dialog__footer {
    @apply flex justify-end gap-2;
  }

  .card-history-dialog {
    @apply flex w-[820px] max-w-[calc(100%-2rem)] max-h-[80vh] flex-col rounded-2xl border border-slate-200 bg-white p-6 shadow-2xl dark:border-slate-700 dark:bg-slate-900;
  }

  .card-history-dialog__header {
    @apply mb-4 flex items-start justify-between;
  }

  .card-history-dialog__eyebrow {
    @apply text-xs uppercase tracking-wide text-slate-400 dark:text-slate-500;
  }

  .card-history-dialog__title {
    @apply text-lg font-semibold text-slate-900 dark:text-slate-100;
  }

  .card-history-dialog__close {
    @apply rounded-full border border-transparent bg-slate-100 px-2 py-1 text-xs font-bold text-slate-500 transition hover:bg-slate-200 hover:text-slate-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-500 dark:bg-slate-800 dark:text-slate-300;
  }

  .card-history-dialog__content {
    @apply flex min-h-0 flex-1 gap-4 overflow-hidden;
  }

  .card-history-dialog__sidebar {
    @apply flex w-56 flex-col gap-2 overflow-y-auto rounded-xl border border-slate-100 bg-slate-50 p-3 dark:border-slate-800 dark:bg-slate-800;
  }

  .card-history-dialog__list {
    @apply flex flex-col gap-2;
  }

  .card-history-dialog__list-button {
    @apply w-full rounded-md border border-transparent bg-white px-2 py-1 text-left text-sm text-slate-700 transition hover:bg-slate-100 dark:bg-slate-900 dark:text-slate-200 dark:hover:bg-slate-700;
  }

  .card-history-dialog__list-button--active {
    @apply border-blue-500 bg-blue-50 text-blue-700 dark:border-blue-400 dark:bg-blue-900/30 dark:text-blue-200;
  }

  .card-history-dialog__list-title {
    @apply block font-semibold;
  }

  .card-history-dialog__list-meta {
    @apply block text-xs text-slate-500 dark:text-slate-400;
  }

  .card-history-dialog__details {
    @apply flex flex-1 flex-col gap-3 overflow-y-auto rounded-xl border border-slate-100 bg-white p-4 dark:border-slate-800 dark:bg-slate-900;
  }

  .card-history-dialog__version-meta {
    @apply flex flex-wrap gap-4 text-sm text-slate-600 dark:text-slate-300;
  }

  .card-history-dialog__footer {
    @apply mt-4 flex justify-end gap-2;
  }

  .card-history-dialog__hint {
    @apply text-sm text-slate-500 dark:text-slate-400;
  }

  .card-diff-viewer {
    @apply grid grid-cols-2 gap-4;
  }

  .card-diff-viewer__column {
    @apply flex flex-col gap-2 rounded-md border border-slate-200 bg-slate-50 p-3 dark:border-slate-700 dark:bg-slate-800;
  }

  .card-diff-viewer__title {
    @apply font-semibold text-slate-800 dark:text-slate-200;
  }

  .card-diff-viewer__body {
    @apply min-h-[120px] whitespace-pre-wrap rounded border border-slate-300 bg-white p-2 text-xs text-slate-800 dark:border-slate-600 dark:bg-slate-900 dark:text-slate-200;
  }

  .card-stats-dialog__overlay {
    @apply z-[60];
  }

  .card-stats-dialog {
    @apply flex w-[560px] max-w-[calc(100%-2rem)] flex-col gap-4 rounded-2xl border border-slate-200 bg-white p-6 shadow-2xl dark:border-slate-700 dark:bg-slate-900;
  }

  .card-stats-dialog__header {
    @apply flex items-start justify-between gap-4;
  }

  .card-stats-dialog__eyebrow {
    @apply text-xs uppercase tracking-wide text-slate-400 dark:text-slate-500;
  }

  .card-stats-dialog__title {
    @apply text-lg font-semibold text-slate-900 dark:text-slate-100;
  }

  .card-stats-dialog__close {
    @apply rounded-full border border-transparent bg-slate-100 px-2 py-1 text-xs font-bold text-slate-500 transition hover:bg-slate-200 hover:text-slate-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-500 dark:bg-slate-800 dark:text-slate-300;
  }

  .card-stats-dialog__section {
    @apply rounded-xl border border-slate-100 bg-slate-50 p-4 dark:border-slate-700 dark:bg-slate-800;
  }

  .card-stats-dialog__section h3 {
    @apply mb-3 text-sm font-semibold text-slate-700 dark:text-slate-200;
  }

  .card-stats-dialog__section dl {
    @apply grid grid-cols-[140px_1fr] gap-y-2 text-sm;
  }

  .card-stats-dialog__section dt {
    @apply text-slate-500 dark:text-slate-400;
  }

  .card-stats-dialog__section dd {
    @apply text-slate-900 dark:text-slate-100;
  }

  .card-stats-dialog__icon {
    @apply mr-1;
  }

  .card-stats-dialog__mono {
    @apply font-mono text-xs text-slate-500 dark:text-slate-400;
  }

  .card-stats-dialog__footer {
    @apply flex justify-end;
  }

  .card-stats-dialog__close-button {
    @apply rounded-md border border-slate-200 px-4 py-2 text-sm font-semibold text-slate-700 transition hover:bg-slate-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-500 dark:border-slate-600 dark:text-slate-200 dark:hover:bg-slate-800;
  }

  /* カードID編集 */
  .card__card-id-edit-container {
    @apply inline-flex items-center gap-1;
  }

  .card__card-id-input {
    @apply rounded-md border border-slate-300 bg-white px-2 py-0.5 text-xs font-mono text-slate-800 shadow-sm focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-500 dark:border-slate-600 dark:bg-slate-800 dark:text-slate-100 dark:placeholder:text-slate-400;
  }

  .card__card-id-input--error {
    @apply border-rose-500 dark:border-rose-400;
  }

  .card__card-id-error {
    @apply text-rose-500 dark:text-rose-400;
  }

  .card__card-id {
    @apply text-xs font-mono text-slate-600 dark:text-slate-300;
  }

  .card__card-id--editable {
    @apply cursor-pointer rounded-md px-1 transition-colors hover:bg-slate-200 dark:hover:bg-slate-700;
  }

  .card__card-id--empty {
    @apply text-slate-400 dark:text-slate-500;
  }

  /* Trace Matrix */
  .trace-matrix-app {
    @apply flex h-screen flex-col bg-theme-background text-theme-foreground;
  }

  .trace-matrix-status {
    @apply px-6 py-2 text-sm text-theme-secondary;
  }

  .trace-matrix-status--error {
    @apply text-rose-500;
  }

  .trace-matrix-dialog {
    @apply flex h-full min-h-0 flex-col gap-2 px-4 pb-4;
  }

  .trace-matrix-content {
    @apply flex flex-1 min-h-0 gap-4;
  }

  .trace-matrix-header {
    @apply flex flex-wrap gap-6 rounded-xl border border-theme-border bg-theme-card p-4 text-sm;
  }

  .trace-matrix-header__label {
    @apply text-xs uppercase tracking-wide text-theme-secondary/70;
  }

  .trace-matrix-header__value {
    @apply block text-base font-semibold text-theme-foreground;
  }

  .trace-matrix-header__count {
    @apply ml-2 text-xs text-theme-secondary/70;
  }

  .trace-matrix-toolbar {
    @apply flex flex-col gap-3 rounded-xl border border-theme-border bg-theme-card px-4 py-3 text-sm;
  }

  .trace-matrix-toolbar__stats {
    @apply flex flex-wrap gap-4 text-theme-secondary;
  }

  .trace-matrix-toolbar__actions {
    @apply flex flex-wrap gap-2;
  }

  .trace-matrix-toolbar__settings {
    @apply flex flex-wrap gap-4 text-xs text-theme-secondary;
  }

  .trace-matrix-toolbar__settings label {
    @apply flex items-center gap-2;
  }

  .trace-matrix-toolbar__settings select {
    @apply rounded border border-theme-border bg-theme-background px-2 py-1 text-sm text-theme-foreground;
  }

  .trace-matrix-toolbar__checkbox {
    @apply inline-flex items-center gap-2 text-sm;
  }

  .trace-matrix-grid {
    @apply flex flex-1 min-h-0 flex-col overflow-hidden rounded-xl border border-theme-border bg-theme-card text-sm;
  }

  .app-shell[data-compact='true'] .trace-matrix-grid {
    @apply text-[12px];
  }

  .trace-matrix-grid__column-header-row {
    @apply flex border-b border-theme-border bg-theme-background;
  }

  .trace-matrix-grid__corner {
    @apply flex items-center justify-center border-r border-theme-border text-xs font-semibold uppercase tracking-wide text-theme-secondary;
  }

  .trace-matrix-grid__column-headers {
    @apply flex gap-0;
  }

  .trace-matrix-grid__body {
    @apply flex min-h-0 flex-1;
  }

  .trace-matrix-grid__row-headers {
    @apply flex flex-col overflow-hidden border-r border-theme-border bg-theme-background;
  }

  .trace-matrix-grid__cells {
    @apply relative flex-1 overflow-hidden;
  }

  .trace-matrix-grid__column-header,
  .trace-matrix-grid__row-header {
    @apply flex flex-col gap-1 border-b border-theme-border px-2 py-2 text-xs text-theme-secondary;
  }

  .trace-matrix-grid__column-header {
    @apply border-l border-theme-border;
  }

  .trace-matrix-grid__row-header {
    @apply border-r border-theme-border;
  }

  .trace-matrix-grid__card-id {
    @apply font-mono text-[0.65rem] uppercase tracking-wide text-theme-secondary/70;
  }

  .trace-matrix-grid__title {
    @apply text-xs font-medium text-theme-foreground;
  }

  .trace-matrix-grid__cell-wrapper {
    @apply p-[2px];
  }

  .trace-matrix-cell {
    @apply flex h-full w-full items-center justify-center border border-theme-border text-sm transition-colors hover:bg-theme-primary/10 focus-visible:outline focus-visible:outline-1 focus-visible:outline-offset-0 focus-visible:outline-theme-primary;
  }

  .trace-matrix-cell--active {
    @apply font-semibold;
  }

  .trace-matrix-cell--row-highlight {
    @apply bg-emerald-50 dark:bg-emerald-500/10;
  }

  .trace-matrix-cell--column-highlight {
    @apply ring-1 ring-emerald-200 dark:ring-emerald-400/40;
  }

  .trace-matrix-cell--kind-trace {
    @apply bg-blue-50 text-blue-700 dark:bg-blue-500/20 dark:text-blue-100;
  }

  .trace-matrix-cell--kind-refines {
    @apply bg-purple-50 text-purple-700 dark:bg-purple-500/20 dark:text-purple-100;
  }

  .trace-matrix-cell--kind-tests {
    @apply bg-amber-50 text-amber-700 dark:bg-amber-500/20 dark:text-amber-100;
  }

  .trace-matrix-cell--kind-duplicates {
    @apply bg-rose-50 text-rose-700 dark:bg-rose-500/20 dark:text-rose-100;
  }

  .trace-matrix-cell--kind-satisfy {
    @apply bg-teal-50 text-teal-700 dark:bg-teal-500/20 dark:text-teal-100;
  }

  .trace-matrix-cell--kind-relate {
    @apply bg-slate-100 text-slate-700 dark:bg-slate-600/40 dark:text-slate-100;
  }

  .trace-matrix-cell--kind-specialize {
    @apply bg-orange-50 text-orange-700 dark:bg-orange-500/20 dark:text-orange-100;
  }

  .trace-matrix-filter {
    @apply w-72 shrink-0 rounded-xl border border-theme-border bg-theme-card p-4 text-sm;
  }

  .trace-matrix-filter__section + .trace-matrix-filter__section {
    @apply mt-4 pt-4 border-t border-theme-border;
  }

  .trace-matrix-filter__section h3 {
    @apply mb-2 text-xs font-semibold uppercase tracking-wide text-theme-secondary/70;
  }

  .trace-matrix-filter__section label {
    @apply mb-3 flex flex-col gap-1 text-xs;
  }

  .trace-matrix-filter__section input,
  .trace-matrix-filter__section select {
    @apply rounded-md border border-theme-border bg-theme-background px-2 py-1 text-sm text-theme-foreground focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-theme-primary;
  }

  .trace-matrix-filter__status-grid {
    @apply grid grid-cols-2 gap-2;
  }

  .trace-matrix-filter__checkbox {
    @apply flex items-center gap-2 text-xs;
  }

  .matrix-launcher {
    @apply fixed inset-0 z-50 flex items-center justify-center;
  }

  .matrix-launcher__backdrop {
    @apply absolute inset-0 bg-slate-900/50 backdrop-blur-sm;
  }

  .matrix-launcher__body {
    @apply relative z-10 w-[420px] max-w-[calc(100%-2rem)] rounded-2xl border border-slate-200 bg-white p-5 shadow-2xl dark:border-slate-700 dark:bg-slate-900;
  }

  .matrix-launcher__header {
    @apply mb-4 flex items-start justify-between;
  }

  .matrix-launcher__content {
    @apply flex flex-col gap-3 text-sm;
  }

  .matrix-launcher__field {
    @apply flex flex-col gap-1;
  }

  .matrix-launcher__field select {
    @apply rounded-md border border-slate-300 bg-white px-2 py-1 text-sm text-slate-900 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-500 dark:border-slate-600 dark:bg-slate-900 dark:text-slate-100;
  }

  .matrix-launcher__error {
    @apply text-sm text-rose-500;
  }

  .matrix-launcher__footer {
    @apply mt-4 flex justify-end gap-2;
  }

  .trace-matrix-grid {
    @apply flex flex-1 flex-col overflow-hidden rounded-xl border border-slate-200 bg-white text-sm dark:border-slate-700 dark:bg-slate-800;
  }

  .trace-matrix-grid__scroll {
    @apply flex-1 min-h-0 h-full w-full overflow-auto;
  }

  .trace-matrix-table {
    @apply min-w-full border-collapse border-spacing-0;
    table-layout: fixed;
  }

  .trace-matrix-table th,
  .trace-matrix-table td {
    @apply border border-slate-200 align-top dark:border-slate-700;
  }

  .trace-matrix-table__corner {
    @apply bg-slate-100 text-xs font-semibold uppercase tracking-wide text-slate-500 dark:bg-slate-800 dark:text-slate-300;
    position: sticky;
    left: 0;
    top: 0;
    z-index: 5;
    width: var(--matrix-row-header-width);
    min-width: var(--matrix-row-header-width);
    max-width: var(--matrix-row-header-width);
  }

  .trace-matrix-table__column-header {
    @apply bg-slate-100 text-left text-xs dark:bg-slate-800;
    position: sticky;
    top: 0;
    z-index: 4;
  }

  .trace-matrix-table__column-header button,
  .trace-matrix-table__row-header button {
    @apply flex w-full flex-col gap-0.5 px-2 py-2 text-left;
  }

  .trace-matrix-table__row-header {
    @apply bg-slate-100 text-xs dark:bg-slate-800;
    position: sticky;
    left: 0;
    z-index: 4;
    width: var(--matrix-row-header-width);
    min-width: var(--matrix-row-header-width);
    max-width: var(--matrix-row-header-width);
  }

  .app-shell[data-compact='true'] .trace-matrix-table__row-header,
  .app-shell[data-compact='true'] .trace-matrix-table__column-header,
  .app-shell[data-compact='true'] .trace-matrix-table__column-count,
  .app-shell[data-compact='true'] .trace-matrix-table__row-count,
  .app-shell[data-compact='true'] .trace-matrix-table__cell button {
    @apply py-1 px-1 leading-tight;
  }

  .app-shell[data-compact='true'] .trace-matrix-table__cell {
    height: 44px;
  }

  .trace-matrix-table__row-title--zero button {
    @apply text-rose-500 dark:text-rose-300;
  }

  .trace-matrix-table__row-count-header {
    @apply bg-slate-100 text-center text-xs font-semibold text-slate-500 dark:bg-slate-800 dark:text-slate-300;
    position: sticky;
    top: 0;
    left: var(--matrix-row-header-width);
    width: var(--matrix-row-count-width);
    min-width: var(--matrix-row-count-width);
    max-width: var(--matrix-row-count-width);
    z-index: 4;
  }

  .trace-matrix-table__row-count {
    @apply bg-white text-center text-sm font-semibold align-middle dark:bg-slate-800;
    position: sticky;
    left: var(--matrix-row-header-width);
    width: var(--matrix-row-count-width);
    min-width: var(--matrix-row-count-width);
    max-width: var(--matrix-row-count-width);
    z-index: 3;
  }

  .trace-matrix-table__column-count {
    @apply bg-slate-50 text-center text-xs font-semibold align-middle dark:bg-slate-900;
    position: sticky;
    top: var(--matrix-header-row-height);
    z-index: 3;
  }

  .trace-matrix-table__count--zero {
    @apply text-rose-500 dark:text-rose-300;
  }

  .trace-matrix-table__column-header--zero button {
    @apply text-rose-500 dark:text-rose-300;
  }

  .trace-matrix-table__cell {
    @apply p-0 align-middle;
    height: 52px;
  }

  .trace-matrix-table__cell button {
    @apply relative flex h-full w-full items-center justify-center border-0 bg-transparent p-0;
  }

  .trace-matrix-cell--has-memo::after {
    content: '✎';
    position: absolute;
    top: 4px;
    right: 4px;
    font-size: 0.65rem;
    color: var(--matrix-memo-indicator, #10b981);
    pointer-events: none;
  }

  .trace-matrix-cell__glyph {
    @apply text-xl;
  }

  .trace-memo-dialog {
    @apply fixed inset-0 z-50 flex items-center justify-center;
  }

  .trace-memo-dialog__backdrop {
    @apply absolute inset-0 bg-slate-900/50 backdrop-blur-sm;
  }

  .trace-memo-dialog__body {
    @apply relative z-10 flex w-full max-w-xl flex-col gap-4 rounded-lg bg-white p-6 shadow-2xl dark:bg-slate-900;
  }

  .trace-memo-dialog__header {
    @apply flex items-start gap-4 text-sm font-semibold text-slate-700 dark:text-slate-200;
  }

  .trace-memo-dialog__label {
    @apply text-xs uppercase tracking-wide text-slate-400;
  }

  .trace-memo-dialog__value {
    @apply text-sm text-slate-900 dark:text-slate-100;
  }

  .trace-memo-dialog__arrow {
    @apply text-lg text-slate-400;
  }

  .trace-memo-dialog__close {
    @apply ml-auto rounded-full p-1 text-slate-500 transition hover:bg-slate-100 hover:text-slate-900 dark:text-slate-300 dark:hover:bg-slate-800;
  }

  .trace-memo-dialog__field {
    @apply flex flex-col gap-2 text-sm text-slate-700 dark:text-slate-200;
  }

  .trace-memo-dialog__field textarea {
    @apply min-h-[120px] w-full rounded border border-slate-300 p-2 text-sm text-slate-900 outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 dark:border-slate-700 dark:bg-slate-800 dark:text-slate-100;
  }

  .trace-memo-dialog__footer {
    @apply flex items-center justify-end gap-3;
  }
}
