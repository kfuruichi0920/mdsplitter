# カード編集アプリケーション - UI画面設計書

## 1. 設計コンセプト

### 1.1 デザインフィロソフィー

本アプリケーションは、大規模プロジェクトにおける非構造化データの構造化とトレーサビリティ管理を実現するため、以下のデザインコンセプトに基づいて設計されています。

**主要コンセプト:**
- **視認性の高さ**: 情報の階層構造とトレーサビリティを直感的に理解できる視覚表現
- **操作効率**: キーボードショートカット、ドラッグ&ドロップ、マルチパネル編集による高速作業
- **情報密度の最適化**: コンパクト/詳細表示の切替により、状況に応じた情報密度を実現
- **モダンなルック&フィール**: シンプルで洗練されたデザイン、ライト/ダークモード対応

### 1.2 カラーパレット

**ライトモード:**
- 背景: `#FFFFFF` (白)
- サブ背景: `#F9FAFB` (グレー50)
- 境界線: `#D1D5DB` (グレー300)
- テキスト: `#111827` (グレー900)
- アクセント: `#3B82F6` (ブルー500)

**ダークモード:**
- 背景: `#111827` (グレー900)
- サブ背景: `#1F2937` (グレー800)
- 境界線: `#374151` (グレー700)
- テキスト: `#F9FAFB` (グレー50)
- アクセント: `#60A5FA` (ブルー400)

**ステータスカラー:**
- Approved（承認済み）: グリーン系 `#D1FAE5` / `#065F46`
- Review（レビュー中）: イエロー系 `#FEF3C7` / `#92400E`
- Draft（下書き）: グレー系 `#F3F4F6` / `#4B5563`
- Deprecated（廃止）: レッド系 `#FEE2E2` / `#991B1B`

## 2. レイアウト構成

### 2.1 全体構造

アプリケーションは以下の5つの主要エリアで構成されています:

```
┌────────────────────┐
│ メニューバー (Menu Bar)                │
├────────────────────┤
│ ツールバー (Tool Bar)                  │
├─────┬──────────────┤
│          │                            │
│サイドバー│                            │
│          │  カードパネルエリア        │
│          │  (カード一覧)              │
│          │                            │
│          │                            │
│          ├──────────────┤
│          │ ログエリア (Log Area)      │
├─────┴──────────────┤
│ ステータスバー (Status Bar)            │
└────────────────────┘
```

カードパネルエリアは、水平方向、垂直方向に、スプリット操作履歴に基づく再帰的グリッド構造とする。(VSCodeのような分割の考え方)。分割されたグリッドを分割ノードを称する。
分割ノードは以下のエリアが表示される。

```
┌────────────┐
│ タブバー (Tab Bar)     │
├────────────┤
│                        │
│                        │
│  カードパネル          │
│                        │
│                        │
└────────────┘
```

カードパネルには、以下のエリアが表示される。

```
┌────────────┐
│ ツールバー (Tool Bar)  │
├────────────┤
│                        │
│                        │
│  カード一覧            │
│                        │
│                        │
└────────────┘
```


### 2.2 寸法と比率

- **メニューバー**: 高さ 32px
- **ツールバー**: 高さ 40px
- **サイドバー**: 幅 256px（可変リサイズ可能）
- **タブバー**: 高さ 36px
- **ログエリア**: 高さ 128px（可変リサイズ可能）
- **ステータスバー**: 高さ 24px
- **カードパネルエリア**: 残りのスペースを均等分割（可変リサイズ可能）

## 3. コンポーネント詳細

### 3.1 メニューバー

**構成要素:**
- ファイル(F): ファイルを開く(O)、上書き保存、名前を付けて保存、終了
- 編集(E): Undo、Redo、設定
- 表示(V): エクスプローラ、検索/置換、各パネル表示切替
- ヘルプ(H): 操作方法、バージョン情報

**デザイン特徴:**
- OSネイティブのメニューバースタイルを踏襲
- ホバー時に背景色を変更してフィードバック
- アクセスキー（F, E, V, H）を表示

### 3.2 ツールバー

**構成要素（左から右へ）:**

1. **ファイル操作グループ**
   - ファイルを開く (📂アイコン)
   - 保存 (💾アイコン)

2. **トレーサビリティグループ**
   - トレース表示切替 (⛓️アイコン) ※トグルボタン
   - トレースタイプフィルタ  (ドロップダウン表示し、トレースタイプ毎にチェックボックスON/OFF)

3. **パネル分割グループ**
   - 水平分割
   - 垂直分割

**デザイン特徴:**
- アイコンサイズ: 20×20px
- ボタンパディング: 8px
- グループ間の区切り線で視覚的にセクション分け
- トグルボタンはアクティブ時にブルー背景

### 3.3 サイドバー

**上部: エクスプローラ**
- フォルダ・ファイルツリー形式でカードファイルを一覧表示
- フォルダには以下の情報を表示:
  - フォルダ (📁)
  - フォルダ名
- 各ファイルには以下の情報を表示:
  - アイコン (📄)
  - ファイル名
  - 未保存マーカー (●、オレンジ色)
- ホバー時に背景色変更
- 選択中ファイルは背景色を青系に変更

**下部: 検索/置換**
- 検索テキストボックス
- 検索アイコン (🔍) を左側に配置
- フォーカス時にブルーのリングを表示

**デザイン特徴:**
- 背景色: グレー50 (ライトモード)
- 境界線: 右側に1pxの境界線
- リサイズハンドル（境界線上でカーソル変更）

### 3.5 カードパネルエリア

水平方向、垂直方向に、スプリット操作履歴に基づく再帰的グリッド構造とする。(VSCodeのような分割の考え方)。
分割サイズは任意に変更可能とする。
分割ノードに、複数のカードパネルを配置可能とする。

### 3.6 分割ノード

#### 3.6.1 タブバー

**構成要素:**
- 開いているファイルごとにタブを表示
- タブには以下を含む:
  - ファイルアイコン (📄)
  - ファイル名
  - 未保存インジケータ (●、オレンジ色)
  - 閉じるボタン (×)
- 右端に新規タブボタン (➕)

**デザイン特徴:**
- アクティブタブ: 白背景、下部境界線なし
- 非アクティブタブ: グレー背景、ホバー時に明るく
- タブ幅: 最大200px、最小100px
- タブは横スクロール可能

#### 3.6.2 カードパネル

カードパネルを表示する。

### 3.5 カードパネル

#### 3.5.1 ツールバー

**構成要素（左から右へ）:**

1. **表示操作グループ**
   - すべて展開 (▼アイコン)
   - すべて折りたたみ (▶アイコン)

2. **表示フィルタグループ**
   - 文字列フィルタ (テキストボックス)
   - カード種別情報フィルタ (ドロップダウン表示し、カード種別情報毎にチェックボックスON/OFF)
   - 選択中カードとトレーサビリティ関係のみ表示するフィルタ (🔽アイコン)

3. **表示モードグループ**
   - コンパクト表示 (☰アイコン) ※トグルボタン

**デザイン特徴:**
- アイコンサイズ: 20×20px
- ボタンパディング: 8px
- グループ間の区切り線で視覚的にセクション分け
- トグルボタンはアクティブ時にブルー背景

#### 3.5.2 カード一覧

##### 3.5.2.1 パネルヘッダー

**構成要素:**
- ファイル名（左側）
- カード総数（右側、小さいフォント）

**デザイン特徴:**
- 背景色: グレー50
- 境界線: 下部に1px
- フォントサイズ: 14px (bold)

##### 3.5.2.2 カード表示

**カード構造（詳細表示モード）:**

```
┌─────────────────────────┐
│ ● [アイコン] [Status Badge]                 ●  │
│                                                  │
│   カードの内容テキスト(テキストボックス)         │
│                                                  │
│   最終更新: 2025-10-19 14:30                     │
└─────────────────────────┘
```

**要素詳細:**

1. **トレース接合点（●）**
   - 位置: カードの左端と右端
   - サイズ: 24×24px
   - 状態:
     - 塗りつぶし (●): トレース関係あり、ブルー色
     - 白抜き (○): トレース関係なし、グレー色

2. **展開/折りたたみボタン**
   - 子カードがある場合のみ表示
   - アイコン: ▼（展開）/ ▶（折りたたみ）
   - サイズ: 16×16px

3. **カード情報種別アイコン**
   - 見出し (heading): 📑
   - 段落 (paragraph): 📝
   - 箇条書き (bullet): •
   - 図 (figure): 🖼️
   - 表 (table): 📊
   - 試験 (test): 🧪
   - QA (qa): 💬

4. **ステータスバッジ**
   - サイズ: 自動幅、高さ 20px
   - 角丸: 12px（完全な角丸）
   - テキスト: 小文字、10px
   - パディング: 左右8px、上下2px

5. **カード内容**
   - テキストボックス（編集可能）
   - フォントサイズ: 14px
   - 行高: 1.5
   - カラー: グレー900

6. **最終更新時刻**
   - フォントサイズ: 12px
   - カラー: グレー500
   - マージン上部: 4px

**カード構造（コンパクト表示モード）:**

```
┌────────────────────────┐
│ ● [アイコン] [Status] カード内容の1行目...    │
└────────────────────────┘
```

- 高さ: 1行分（約32px）
- 内容は1行で切り詰め（truncate）

#### 3.5.3 階層表示

**インデント:**
- レベル0（ルート）: インデント 12px
- レベル1: インデント 36px（+24px）
- レベル2: インデント 60px（+24px）
- レベルN: インデント 12 + (N × 24)px

**視覚表現:**
- 階層ごとにインデントを追加
- 折りたたみ可能なノードには展開/折りたたみボタンを表示
- 親カードが折りたたまれた場合、子カードは非表示

#### 3.5.4 選択状態

**単一選択:**
- 背景色: ブルー100
- 左境界線: 4px、ブルー500

**複数選択（CTRL/SHIFT）:**
- 同様のスタイルを複数カードに適用

**ホバー状態:**
- 背景色: ブルー50
- トランジション: 0.15s ease-out

### 3.6 トレーサビリティコネクタ

**視覚表現:**

1. **コネクタライン**
   - SVG要素として描画
   - ストローク幅: 2px
   - カラー: ブルー500
   - 透明度: 0.6

2. **方向性の表現**
   - 片方向: 矢印 (→)
   - 双方向: 両矢印 (↔)
   - 無方向: 矢印なし (—)

3. **関係性の種類**
   - trace（トレース）: 実線
   - refines（詳細化）: 破線
   - tests（テスト）: 点線
   - duplicates（重複）: 太線（3px）
   - satisfy（要求満足）: 実線
   - relate（関係）: 実線
   - specialize（特化）: 実線

4. **インタラクティブ動作**
   - ホバー時: 透明度 1.0、ストローク幅 3px
   - 選択時: カラーをオレンジに変更

**コネクタの配置:**
- 水平分割された隣り合った左右のパネルに対し、左パネルのカードの右端トレース接合点から、右パネルのカードの左端トレース接合点へ
- Bézier曲線を使用して自然な曲線を描画

### 3.7 ログエリア

**構成:**

1. **ヘッダー**
   - 「動作ログ」タイトル（左側）
   - 「クリア」ボタン（右側）
   - 背景色: グレー100

2. **ログ表示エリア**
   - 等幅フォント（monospace）
   - フォントサイズ: 12px
   - 背景色: グレー50
   - スクロール可能

3. **ログレベルのカラーリング**
   - INFO: グリーン600
   - WARN: イエロー600
   - ERROR: レッド600
   - DEBUG: ブルー600

**ログフォーマット:**
```
[YYYY-MM-DD HH:MM:SS] LEVEL: メッセージ内容
```

### 3.8 ステータスバー

**左側グループ:**
- 総カード数
- 選択中のカード番号
- 保存状態インジケータ
  - ✓ 保存済み（グリーン）
  - ● 未保存（オレンジ）

**右側グループ:**
- 文字コード（例: UTF-8）
- テーマモード（例: ライトモード）

**デザイン特徴:**
- フォントサイズ: 11px
- 背景色: グレー100
- 境界線: 上部に1px
- 高さ: 24px

## 4. インタラクション設計

### 4.1 カード操作

#### 4.1.1 選択
- **単一選択**: クリック
- **複数選択（離散）**: CTRL + クリック
- **複数選択（連続）**: SHIFT + クリック
- **全選択**: CTRL + A

#### 4.1.2 移動
- **ドラッグ&ドロップ**: カードをドラッグして移動
- **視覚フィードバック**:
  - ドラッグ中: カードを半透明化（opacity: 0.5）
  - ドロップ先: 青色の挿入線を表示
  - ホバー: カーソルを「move」に変更

#### 4.1.3 展開/折りたたみ
- **ボタンクリック**: 展開/折りたたみボタンをクリック
- **ダブルクリック**: カード自体をダブルクリック
- **キーボード**: 選択中カードに対して
  - 右矢印 (→): 展開
  - 左矢印 (←): 折りたたみ

#### 4.1.4 編集
- **内容編集**: カードをダブルクリックで編集モードに
- **ステータス変更**: ステータスバッジをクリックでドロップダウン表示
- **複数カード編集**: 複数選択時、共通プロパティを一括編集可能

### 4.2 トレーサビリティ操作

#### 4.2.1 コネクタ作成
1. カードの接合点をマウスダウン
2. 対象カードの接合点までドラッグ
3. マウスアップで接続確定
4. コネクタのプロパティダイアログ表示

#### 4.2.2 コネクタ編集
- **端点移動**: コネクタの端をドラッグ
- **削除**: コネクタを選択してDELETEキー
- **プロパティ変更**: コネクタを右クリック

#### 4.2.3 トレース強調表示
- カード選択時、関連するすべてのコネクタとカードをハイライト
- ハイライト色: オレンジ400
- 非関連要素: 透明度を下げる（opacity: 0.3）

### 4.3 キーボードショートカット

**ファイル操作:**
- CTRL + O: ファイルを開く
- CTRL + S: 上書き保存
- CTRL + SHIFT + S: 名前を付けて保存

**編集操作:**
- CTRL + Z: Undo
- CTRL + Y / CTRL + SHIFT + Z: Redo
- CTRL + C: コピー
- CTRL + X: カット
- CTRL + V: ペースト
- DELETE: 削除

**表示操作:**
- CTRL + F: 検索
- CTRL + H: 置換
- CTRL + B: サイドバー表示切替
- CTRL + L: ログエリア表示切替

**カード操作:**
- ↑↓: カード選択移動
- →: 展開
- ←: 折りたたみ
- CTRL + ↑↓: カード移動
- ENTER: 編集モードに

**表示モード:**
- CTRL + 1: 詳細表示
- CTRL + 2: コンパクト表示
- CTRL + T: トレース表示切替

## 5. レスポンシブ対応

### 5.1 ウィンドウサイズ対応

**最小ウィンドウサイズ:**
- 幅: 1024px
- 高さ: 768px

**推奨ウィンドウサイズ:**
- 幅: 1920px
- 高さ: 1080px

**リサイズ動作:**
- サイドバー、ログエリアは可変サイズ
- カードパネルは均等分割（可変）
- メニューバー、ツールバー、ステータスバーは固定

### 5.2 分割パネル

**分割方向:**
- 垂直分割: 左右に最大4分割
- 水平分割: 上下に最大4分割
- 組み合わせ: グリッドレイアウト（最大16パネル）

**リサイズ:**
- パネル間の境界線をドラッグしてリサイズ
- 最小パネルサイズ: 200px × 200px

## 6. アニメーション

### 6.1 トランジション

**要素表示:**
- スライドイン: 0.2s ease-out
- フェードイン: 0.15s ease-in

**ホバー効果:**
- 背景色変更: 0.15s ease-out
- ボタンスケール: 0.1s ease-in-out

**カード展開/折りたたみ:**
- 高さアニメーション: 0.2s ease-in-out

### 6.2 マイクロインタラクション

**ボタン:**
- クリック時: スケール 0.95（0.1s）
- ホバー時: 背景色変更（0.15s）

**カード:**
- ドラッグ時: リフト効果（box-shadow）
- ドロップ時: バウンス効果（0.3s ease-out）

**コネクタ:**
- ホバー時: 太さ変更（0.2s）
- 選択時: カラー変更（0.15s）

## 7. アクセシビリティ

### 7.1 カラーコントラスト

**WCAG 2.1 AAレベル準拠:**
- テキストとバックグラウンドのコントラスト比: 最小4.5:1
- 大きいテキスト（18pt以上）: 最小3:1
- UIコンポーネント: 最小3:1

### 7.2 キーボードナビゲーション

**フォーカス表示:**
- フォーカスリング: 2px、ブルー500
- フォーカス可能な全要素に適用

**タブオーダー:**
1. メニューバー
2. ツールバー
3. サイドバー
4. カードパネル
5. ログエリア

### 7.3 スクリーンリーダー対応

- すべてのインタラクティブ要素にaria-label設定
- 階層構造にaria-level設定
- ライブリージョン（ログエリア）にaria-live設定

## 8. パフォーマンス最適化

### 8.1 仮想スクロール

**大量カード表示:**
- 表示範囲外のカードはDOM非生成
- スクロール時に動的に生成/破棄
- バッファ: 上下各10カード

### 8.2 遅延ロード

**画像/図表:**
- 表示範囲内に入った時点でロード
- サムネイル→高解像度の段階的ロード

### 8.3 最適化技術

**React最適化:**
- memo化: React.memo使用
- コールバック最適化: useCallback使用
- 不要な再レンダリング防止: useMemo使用

**レンダリング最適化:**
- リスト: key属性による差分検出
- 仮想スクロール: react-window使用
- コネクタ: Canvas APIまたはSVG最適化

## 9. 実装技術スタック

### 9.1 フレームワーク/ライブラリ

**コア:**
- Electron: デスクトップアプリフレームワーク
- React 18: UIライブラリ
- TypeScript: 型安全な開発

**UI/スタイリング:**
- Tailwind CSS: ユーティリティファーストCSS
- Lucide React: アイコンライブラリ

**状態管理:**
- Zustand または Redux Toolkit: グローバル状態管理
- React Context: ローカル状態管理

**その他:**
- react-window: 仮想スクロール
- react-dnd: ドラッグ&ドロップ
- react-split-pane: パネルリサイズ

### 9.2 ファイル構造

```
src/
├── main/              # Electronメインプロセス
│   ├── index.ts
│   └── ipc/          # IPC通信
├── renderer/         # Reactレンダラープロセス
│   ├── components/   # UIコンポーネント
│   │   ├── MenuBar/
│   │   ├── ToolBar/
│   │   ├── Sidebar/
│   │   ├── CardPanel/
│   │   ├── Card/
│   │   ├── Connector/
│   │   ├── LogArea/
│   │   └── StatusBar/
│   ├── hooks/        # カスタムフック
│   ├── stores/       # 状態管理
│   ├── utils/        # ユーティリティ
│   └── App.tsx       # ルートコンポーネント
└── shared/           # 共有型定義
```

## 10. 今後の拡張性

### 10.1 プラグインシステム

**カスタムカードタイプ:**
- プラグインによる新しいカード種別追加
- カスタムレンダラー登録

**カスタムコネクタスタイル:**
- プラグインによる新しいトレース関係追加
- カスタムビジュアライゼーション

### 10.2 テーマシステム

**カスタムテーマ:**
- JSONによるテーマ定義
- カラー、フォント、スペーシングのカスタマイズ
- テーマのインポート/エクスポート

### 10.3 コラボレーション機能（将来）

**リアルタイム編集:**
- WebSocketによる複数ユーザー編集
- 競合解決メカニズム
- カーソル位置の表示

---

**作成日**: 2025-10-19  
**バージョン**: 1.0  
**作成者**: Claude (Anthropic)
